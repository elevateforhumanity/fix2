import{r as e,j as r}from"./vendor-react-mXmGo1rS.js";import{L as t}from"./vendor-router-umqT_8ks.js";import{supabase as a}from"./supabaseClient-mnOK5lWJ.js";import{A as s}from"./AppLayout-C3pbRaS2.js";import"./vendor-BU8AdXDg.js";import"./vendor-supabase-BOQaJsF3.js";function n(){const[n,i]=e.useState(!0),[d,o]=e.useState([]),[l,c]=e.useState("all"),[x,b]=e.useState(null);e.useEffect(()=>{m()},[]);const m=async()=>{if(!a)return b("Database service is not available"),void i(!1);try{i(!0),b(null);const{data:{user:e}}=await a.auth.getUser();if(!e)return void b("Please log in to view notifications");const{data:r,error:t}=await a.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(t)throw t;o(r||[])}catch(e){console.error("Error fetching notifications:",e),b(e.message)}finally{i(!1)}},u=async e=>{if(a)try{const{error:r}=await a.from("notifications").update({read:!0}).eq("id",e);if(r)throw r;o(d.map(r=>r.id===e?{...r,read:!0}:r))}catch(r){console.error("Error marking notification as read:",r)}},f=d.filter(e=>"unread"===l?!e.read:"read"!==l||e.read),h=d.filter(e=>!e.read).length,p=e=>{switch(e){case"success":return"✓";case"warning":return"⚠️";case"error":return"✗";default:return"ℹ️"}},g=e=>{switch(e){case"success":return"bg-green-50 border-green-200";case"warning":return"bg-yellow-50 border-yellow-200";case"error":return"bg-red-50 border-red-200";default:return"bg-blue-50 border-blue-200"}};return r.jsx(s,{children:r.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h1",{className:"text-3xl font-bold",children:"Notification Center"}),h>0&&r.jsx("button",{onClick:async()=>{if(a)try{const{data:{user:e}}=await a.auth.getUser();if(!e)return;const{error:r}=await a.from("notifications").update({read:!0}).eq("user_id",e.id).eq("read",!1);if(r)throw r;o(d.map(e=>({...e,read:!0})))}catch(e){console.error("Error marking all as read:",e)}},className:"px-4 py-2 bg-brand-info text-white rounded-lg hover:bg-brand-info-hover transition text-sm",children:"Mark All as Read"})]}),x&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:r.jsx("p",{className:"text-red-800",children:x})}),r.jsx("div",{className:"bg-white rounded-lg shadow mb-6",children:r.jsxs("div",{className:"flex border-b",children:[r.jsxs("button",{onClick:()=>c("all"),className:"flex-1 px-6 py-3 font-medium transition "+("all"===l?"border-b-2 border-blue-600 text-brand-info":"text-brand-text-muted hover:text-brand-text"),children:["All (",d.length,")"]}),r.jsxs("button",{onClick:()=>c("unread"),className:"flex-1 px-6 py-3 font-medium transition "+("unread"===l?"border-b-2 border-blue-600 text-brand-info":"text-brand-text-muted hover:text-brand-text"),children:["Unread (",h,")"]}),r.jsxs("button",{onClick:()=>c("read"),className:"flex-1 px-6 py-3 font-medium transition "+("read"===l?"border-b-2 border-blue-600 text-brand-info":"text-brand-text-muted hover:text-brand-text"),children:["Read (",d.length-h,")"]})]})}),n?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-brand-text-muted",children:"Loading notifications..."})]}):0===f.length?r.jsx("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:r.jsx("p",{className:"text-brand-text-light text-lg",children:"No notifications to display"})}):r.jsx("div",{className:"space-y-3",children:f.map(e=>r.jsx("div",{className:`border-2 rounded-lg p-4 transition ${e.read?"bg-white border-brand-border":g(e.type)} ${e.read?"":"shadow-md"}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-start flex-1",children:[r.jsx("span",{className:"text-2xl mr-3",children:p(e.type)}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("h3",{className:"font-bold text-lg mb-1",children:[e.title,!e.read&&r.jsx("span",{className:"ml-2 px-2 py-1 bg-brand-info text-white text-xs rounded-full",children:"New"})]}),r.jsx("p",{className:"text-brand-text mb-2",children:e.message}),r.jsx("p",{className:"text-sm text-brand-text-light",children:new Date(e.created_at).toLocaleString()}),e.link&&r.jsx(t,{to:e.link,onClick:()=>u(e.id),className:"inline-block mt-2 text-brand-info hover:underline text-sm font-medium",children:"View Details →"})]})]}),r.jsxs("div",{className:"flex gap-2 ml-4",children:[!e.read&&r.jsx("button",{onClick:()=>u(e.id),className:"px-3 py-1 bg-brand-surface text-brand-info rounded hover:bg-blue-200 text-sm transition",children:"Mark Read"}),r.jsx("button",{onClick:()=>(async e=>{try{const{error:r}=await a.from("notifications").delete().eq("id",e);if(r)throw r;o(d.filter(r=>r.id!==e))}catch(r){console.error("Error deleting notification:",r)}})(e.id),className:"px-3 py-1 bg-brand-surface text-red-700 rounded hover:bg-red-200 text-sm transition",children:"Delete"})]})]})},e.id))})]})})}export{n as default};
