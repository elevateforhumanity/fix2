import{r as e,j as a,o as s,p as t,q as r,s as l,Y as n,t as d,L as i,u as o,v as c,w as h}from"./vendor-react-mXmGo1rS.js";import{A as x}from"./AppLayout-C3pbRaS2.js";import"./vendor-BU8AdXDg.js";import"./vendor-router-umqT_8ks.js";function u(){var u,m,p,b,g,j;const[f,y]=e.useState(!1),[N,v]=e.useState([]),[w,k]=e.useState(!1),[S,$]=e.useState(""),[C,_]=e.useState("generate_page"),[T,E]=e.useState("{}"),[O,R]=e.useState(null),[L,D]=e.useState(new Date(Date.now()-864e5).toISOString().slice(0,10)),[A,K]=e.useState((new Date).toISOString().slice(0,10)),[I,J]=e.useState(""),[P,F]=e.useState(""),[z,M]=e.useState([]),[G,U]=e.useState(null),[H,Y]=e.useState(""),[B,q]=e.useState(30),[W,Q]=e.useState(null),[V,X]=e.useState(""),[Z,ee]=e.useState(""),[ae,se]=e.useState(""),te="https://efh-autopilot-orchestrator.workers.dev",re="https://efh-autopilot-analyzer.workers.dev",le=(e,a="info")=>{Y(e),setTimeout(()=>Y(""),3e3)};async function ne(){k(!0);try{const e=await fetch(`${te}/autopilot/list`),a=await e.json();v(a.autopilots||[]),le("Autopilots loaded","success")}catch(e){le(`Error: ${e}`,"error"),$(`âŒ Error fetching autopilots: ${e}`)}k(!1)}async function de(){k(!0);try{const e=await fetch(`${re}/logs/stats?days=${B}`),a=await e.json();Q(a),le("Stats loaded","success")}catch(e){le(`Error: ${e}`,"error")}k(!1)}const ie=e=>{navigator.clipboard.writeText(e),le("Copied to clipboard","success")};e.useEffect(()=>{ne(),de()},[]),e.useEffect(()=>{de()},[B]);const oe=f?"bg-gray-900 text-white":"bg-brand-surface text-brand-text",ce=f?"bg-gray-800 border-gray-700":"bg-white border-brand-border",he=f?"bg-gray-700 border-gray-600 text-white":"bg-white border-brand-border-dark text-brand-text";return a.jsx(x,{children:a.jsxs("div",{className:`min-h-screen p-6 ${oe}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-6",children:[a.jsx("h1",{className:"text-3xl font-bold text-red-600",children:"âš™ï¸ Autopilot Admin Console"}),a.jsx("button",{onClick:()=>y(!f),className:"px-4 py-2 rounded bg-gray-700 text-white hover:bg-gray-600",children:f?"â˜€ï¸ Light":"ðŸŒ™ Dark"})]}),H&&a.jsx("div",{className:"fixed top-4 right-4 bg-brand-info text-white px-4 py-2 rounded shadow-lg z-50",children:H}),a.jsxs("div",{className:`mb-6 p-4 border rounded-lg shadow ${ce}`,children:[a.jsx("h2",{className:"font-semibold mb-4 text-brand-info text-xl",children:"ðŸŽ¯ Orchestrator"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Registered Autopilots"}),w&&a.jsx("p",{children:"Loading..."}),!w&&0===N.length&&a.jsx("p",{className:"text-brand-text-light",children:"No autopilots registered yet."}),!w&&N.length>0&&a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full text-sm border-collapse",children:[a.jsx("thead",{children:a.jsxs("tr",{className:f?"bg-gray-700":"bg-brand-surface-dark",children:[a.jsx("th",{className:"p-2 text-left",children:"Name"}),a.jsx("th",{className:"p-2 text-left",children:"Capabilities"}),a.jsx("th",{className:"p-2 text-left",children:"Endpoint"})]})}),a.jsx("tbody",{children:N.map(e=>a.jsxs("tr",{className:"border-t",children:[a.jsx("td",{className:"p-2 font-medium text-orange-600",children:e.name}),a.jsx("td",{className:"p-2",children:(e.capabilities||[]).join(", ")}),a.jsxs("td",{className:"p-2 text-brand-info text-xs",children:[e.endpoint,a.jsx("button",{onClick:()=>ie(e.endpoint),className:"ml-2 text-brand-text-light hover:text-brand-info",children:"ðŸ“‹"})]})]},e.name))})]})})]}),a.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-4",children:[a.jsx("button",{onClick:async function(){$("Running diagnostics...");try{const e=await fetch(`${te}/autopilot/diagnose`),a=await e.json();R(a),$(JSON.stringify(a,null,2)),le("Diagnostics complete","success")}catch(e){le(`Error: ${e}`,"error"),$(`âŒ Error running diagnostics: ${e}`)}},className:"bg-brand-info text-white px-4 py-2 rounded hover:bg-brand-info-hover",children:"ðŸ” Diagnostics"}),a.jsx("button",{onClick:async function(){$("Healing infrastructure...");try{const e=await fetch(`${te}/autopilot/ensure-infra`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({want:{kvNamespaces:["REGISTRY","AI_EMPLOYEE_LOGS","LOGS","SUMMARIES"],r2Buckets:["efh-assets","efh-images","efh-pages"]}})}),a=await e.json();$(JSON.stringify(a,null,2)),le("Infrastructure healed","success")}catch(e){le(`Error: ${e}`,"error"),$(`âŒ Error healing infrastructure: ${e}`)}},className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600",children:"ðŸ©º Heal Infra"}),a.jsx("button",{onClick:ne,className:"bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800",children:"ðŸ” Refresh"}),a.jsx("button",{onClick:()=>ie(te),className:"bg-brand-secondary text-white px-4 py-2 rounded hover:bg-brand-secondary-hover",children:"ðŸ“‹ Copy URL"})]}),a.jsxs("div",{className:`p-4 border rounded mb-4 ${ce}`,children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Register New Autopilot"}),a.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[a.jsx("input",{className:`border p-2 rounded ${he}`,placeholder:"Name (e.g., ai-employee)",value:V,onChange:e=>X(e.target.value)}),a.jsx("input",{className:`border p-2 rounded ${he}`,placeholder:"Endpoint URL",value:Z,onChange:e=>ee(e.target.value)}),a.jsx("input",{className:`border p-2 rounded ${he}`,placeholder:"Capabilities (comma-separated)",value:ae,onChange:e=>se(e.target.value)})]}),a.jsx("button",{onClick:async function(){if(V&&Z&&ae)try{const e=ae.split(",").map(e=>e.trim()),a=await fetch(`${te}/autopilot/registry`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:V,endpoint:Z,capabilities:e})}),s=await a.json();$(JSON.stringify(s,null,2)),le("Autopilot registered","success"),X(""),ee(""),se(""),ne()}catch(e){le(`Error: ${e}`,"error")}else le("Fill all fields","error")},className:"bg-brand-success text-white px-4 py-2 mt-3 rounded hover:bg-brand-success-hover",children:"âž• Register"})]}),O&&a.jsxs("div",{className:`p-4 border rounded mb-4 ${ce}`,children:[a.jsx("h3",{className:"font-semibold text-lg mb-2 text-green-700",children:"Diagnostic Summary"}),a.jsx("pre",{className:"text-xs overflow-auto max-h-64",children:JSON.stringify(O,null,2)})]}),a.jsxs("div",{className:`p-4 border rounded ${ce}`,children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Run Task"}),a.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block font-medium mb-1",children:"Task Name"}),a.jsxs("select",{className:`border p-2 w-full rounded ${he}`,value:C,onChange:e=>_(e.target.value),children:[a.jsx("option",{value:"generate_page",children:"Generate Page"}),a.jsx("option",{value:"deploy_page",children:"Deploy Page"}),a.jsx("option",{value:"generate_asset",children:"Generate Asset"}),a.jsx("option",{value:"process_email",children:"Process Email"}),a.jsx("option",{value:"create_lead",children:"Create Lead"}),a.jsx("option",{value:"send_followup",children:"Send Follow-up"}),a.jsx("option",{value:"make_checkout",children:"Make Checkout"}),a.jsx("option",{value:"enroll_student",children:"Enroll Student"}),a.jsx("option",{value:"run_payout_batch",children:"Run Payout Batch"}),a.jsx("option",{value:"pay_affiliate_now",children:"Pay Affiliate Now"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block font-medium mb-1",children:"Meta (JSON)"}),a.jsx("textarea",{className:`border p-2 rounded w-full h-20 font-mono text-xs ${he}`,value:T,onChange:e=>E(e.target.value),placeholder:'{"pageType": "home"}'})]})]}),a.jsx("button",{onClick:async function(){$("Running task...");try{const e=JSON.parse(T||"{}"),a=await fetch(`${te}/autopilot/plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task:C,meta:e})}),s=await a.json();$(JSON.stringify(s,null,2)),le("Task executed","success")}catch(e){le(`Error: ${e}`,"error"),$(`âŒ Error running task: ${e}`)}},className:"bg-brand-success text-white px-4 py-2 mt-3 rounded hover:bg-brand-success-hover",children:"ðŸš€ Run Task"})]})]}),a.jsxs("div",{className:`mb-6 p-4 border rounded-lg shadow ${ce}`,children:[a.jsx("h2",{className:"font-semibold mb-4 text-brand-info text-xl",children:"ðŸ“Š Log Analyzer"}),a.jsxs("div",{className:"grid md:grid-cols-5 gap-3 mb-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"From"}),a.jsx("input",{type:"date","aria-label":"date input",className:`border p-2 rounded w-full ${he}`,value:L,onChange:e=>D(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"To"}),a.jsx("input",{type:"date","aria-label":"date input",className:`border p-2 rounded w-full ${he}`,value:A,onChange:e=>K(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Capability"}),a.jsx("input",{className:`border p-2 rounded w-full ${he}`,value:I,onChange:e=>J(e.target.value),placeholder:"e.g. payouts.batch.run"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm",children:"Task"}),a.jsx("input",{className:`border p-2 rounded w-full ${he}`,value:P,onChange:e=>F(e.target.value),placeholder:"e.g. run_payout_batch"})]}),a.jsx("div",{className:"flex items-end gap-2",children:a.jsx("button",{onClick:async function(){k(!0);const e=new URLSearchParams({from:L,to:A,...I?{cap:I}:{},...P?{task:P}:{}});try{const a=await fetch(`${re}/logs/list?${e}`),s=await a.json();M(s.logs||[]),le("Logs loaded","success")}catch(a){le(`Error: ${a}`,"error")}k(!1)},className:"bg-gray-700 text-white px-3 py-2 rounded w-full",children:"Refresh"})})]}),a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx("button",{onClick:async function(){k(!0),Y("Summarizingâ€¦");try{const e=await fetch(`${re}/logs/summarize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:L,to:A})}),a=await e.json();U(a),le("Summary generated","success")}catch(e){le(`Error: ${e}`,"error")}Y(""),k(!1)},className:"bg-brand-info text-white px-3 py-2 rounded",children:"AI Summarize"}),a.jsx("button",{onClick:async function(){try{const e=await fetch(`${re}/logs/summary?date=${A}`),a=await e.json();U(a),le("Daily summary loaded","success")}catch(e){le(`Error: ${e}`,"error")}},className:"bg-orange-500 text-white px-3 py-2 rounded",children:"Load Daily Digest"}),a.jsx("button",{onClick:()=>ie(re),className:"bg-brand-secondary text-white px-3 py-2 rounded",children:"ðŸ“‹ Copy URL"}),w&&a.jsx("span",{className:"text-sm text-brand-text-light",children:"Workingâ€¦"})]}),G&&a.jsxs("div",{className:`p-4 border rounded mb-6 shadow ${ce}`,children:[a.jsxs("h2",{className:"font-semibold text-lg text-brand-info",children:["Summary: ",G.date]}),a.jsxs("p",{className:"text-sm text-brand-text-muted mb-2",children:["OK: ",null!=(m=null==(u=G.counts)?void 0:u.ok)?m:G.n_ok," Â· Fail:"," ",null!=(b=null==(p=G.counts)?void 0:p.fail)?b:G.n_fail]}),a.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:(G.summary_markdown||"").replace(/\n/g,"<br/>")}}),(null==(g=G.highlights)?void 0:g.length)?a.jsx("ul",{className:"list-disc pl-6 mt-2",children:G.highlights.map((e,s)=>a.jsx("li",{children:e},s))}):null,(null==(j=G.next_actions)?void 0:j.length)?a.jsxs(a.Fragment,{children:[a.jsx("h3",{className:"font-semibold mt-3",children:"Next actions"}),a.jsx("ul",{className:"list-disc pl-6",children:G.next_actions.map((e,s)=>a.jsx("li",{children:e},s))})]}):null]}),a.jsx("div",{className:"overflow-x-auto border rounded",children:a.jsxs("table",{className:"min-w-full text-sm",children:[a.jsx("thead",{className:f?"bg-gray-700":"bg-brand-surface-dark",children:a.jsxs("tr",{children:[a.jsx("th",{className:"p-2 text-left",children:"Time"}),a.jsx("th",{className:"p-2 text-left",children:"Autopilot"}),a.jsx("th",{className:"p-2 text-left",children:"Task"}),a.jsx("th",{className:"p-2 text-left",children:"Capability"}),a.jsx("th",{className:"p-2 text-left",children:"OK"}),a.jsx("th",{className:"p-2 text-left",children:"Level"})]})}),a.jsxs("tbody",{children:[z.map((e,s)=>a.jsxs("tr",{className:"border-t",children:[a.jsx("td",{className:"p-2",children:new Date(e.ts).toLocaleString()}),a.jsx("td",{className:"p-2",children:e.autopilot}),a.jsx("td",{className:"p-2",children:e.task}),a.jsx("td",{className:"p-2",children:e.capability}),a.jsx("td",{className:"p-2 "+(e.ok?"text-green-700":"text-red-600"),children:e.ok?"yes":"no"}),a.jsx("td",{className:"p-2",children:e.level})]},s)),!z.length&&a.jsx("tr",{children:a.jsx("td",{className:"p-4 text-center text-brand-text-light",colSpan:6,children:"No events"})})]})]})})]}),a.jsxs("div",{className:`mb-6 p-4 border rounded-lg shadow ${ce}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[a.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"ðŸ“ˆ Trends"}),a.jsxs("select",{className:`border p-2 rounded ${he}`,value:B,onChange:e=>q(Number(e.target.value)),children:[a.jsx("option",{value:7,children:"7 days"}),a.jsx("option",{value:14,children:"14 days"}),a.jsx("option",{value:30,children:"30 days"}),a.jsx("option",{value:60,children:"60 days"})]})]}),W&&a.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[a.jsxs("div",{className:`border rounded-lg p-4 shadow ${ce}`,children:[a.jsx("h3",{className:"font-semibold mb-2 text-brand-info",children:"Daily OK vs Fail"}),a.jsx(s,{width:"100%",height:260,children:a.jsxs(t,{data:W.daily,children:[a.jsx(r,{strokeDasharray:"3 3"}),a.jsx(l,{dataKey:"day",hide:!0}),a.jsx(n,{}),a.jsx(d,{}),a.jsx(i,{}),a.jsx(o,{dataKey:"ok",stackId:"a",fill:"var(--brand-success)"}),a.jsx(o,{dataKey:"fail",stackId:"a",fill:"var(--brand-danger)"})]})}),a.jsxs("p",{className:"text-xs text-brand-text-light mt-1",children:["Range: ",W.range.start," â†’ ",W.range.end]})]}),a.jsxs("div",{className:`border rounded-lg p-4 shadow ${ce}`,children:[a.jsx("h3",{className:"font-semibold mb-2 text-brand-info",children:"% Failure Rate"}),a.jsx(s,{width:"100%",height:260,children:a.jsxs(c,{data:W.daily,children:[a.jsx(r,{strokeDasharray:"3 3"}),a.jsx(l,{dataKey:"day",hide:!0}),a.jsx(n,{domain:[0,"auto"]}),a.jsx(d,{}),a.jsx(h,{type:"monotone",dataKey:"fail_rate",stroke:"var(--brand-danger)",dot:!1})]})})]}),a.jsxs("div",{className:`border rounded-lg p-4 shadow md:col-span-2 ${ce}`,children:[a.jsx("h3",{className:"font-semibold mb-2 text-brand-info",children:"Top Tasks (volume & failure %)"}),a.jsx(s,{width:"100%",height:300,children:a.jsxs(t,{data:W.by_task,children:[a.jsx(r,{strokeDasharray:"3 3"}),a.jsx(l,{dataKey:"key"}),a.jsx(n,{}),a.jsx(d,{}),a.jsx(i,{}),a.jsx(o,{dataKey:"total",fill:"var(--brand-info)"}),a.jsx(o,{dataKey:"fail_rate",fill:"#f97316"})]})})]}),a.jsxs("div",{className:`border rounded-lg p-4 shadow md:col-span-2 ${ce}`,children:[a.jsx("h3",{className:"font-semibold mb-2 text-brand-info",children:"Top Autopilots (volume & failure %)"}),a.jsx(s,{width:"100%",height:300,children:a.jsxs(t,{data:W.by_autopilot,children:[a.jsx(r,{strokeDasharray:"3 3"}),a.jsx(l,{dataKey:"key"}),a.jsx(n,{}),a.jsx(d,{}),a.jsx(i,{}),a.jsx(o,{dataKey:"total",fill:"var(--brand-secondary)"}),a.jsx(o,{dataKey:"fail_rate",fill:"var(--brand-danger)"})]})})]})]})]}),a.jsx("div",{className:"p-4 rounded-lg font-mono text-sm whitespace-pre-wrap max-h-96 overflow-auto "+(f?"bg-black text-green-400":"bg-brand-surface-dark text-brand-text"),children:S||"Ready."})]})})}export{u as default};
