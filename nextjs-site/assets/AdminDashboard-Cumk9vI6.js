import{j as e,r}from"./vendor-react-mXmGo1rS.js";import{L as t}from"./vendor-router-umqT_8ks.js";import{u as o}from"./useAnalyticsEvent-L1QgJF4b.js";import{a,L as s}from"./api-C7NPfHSN.js";import{s as l}from"./supa-BrS98-L_.js";import{A as n}from"./AppLayout-C3pbRaS2.js";import"./vendor-BU8AdXDg.js";import"./auth-1fW2cf6c.js";import"./vendor-supabase-BOQaJsF3.js";const i=({title:r,value:t,icon:o,trend:a})=>e.jsxs("div",{className:"stat-card",children:[e.jsx("div",{className:"stat-icon",children:o}),e.jsxs("div",{className:"stat-content",children:[e.jsx("h3",{children:r}),e.jsx("p",{className:"stat-value",children:t}),a&&e.jsx("span",{className:"stat-trend",children:a})]})]}),c=({data:r,title:t})=>e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:t}),e.jsx("div",{className:"chart-placeholder",children:"Line chart visualization"})]}),d=({data:r,title:t})=>e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:t}),e.jsx("div",{className:"chart-placeholder",children:"Bar chart visualization"})]}),v=({data:r,title:t})=>e.jsxs("div",{className:"chart-container",children:[e.jsx("h3",{children:t}),e.jsx("div",{className:"chart-placeholder",children:"Pie chart visualization"})]}),h={totalEvents:0,eventsLast7Days:0,activeStudentsLast30Days:0,series:[],topEvents:[]};const u={backgroundColor:"var(--color-card-bg)",border:"1px solid var(--color-border)",borderRadius:12,padding:24,display:"flex",flexDirection:"column",gap:16};function g(){const[t,o]=r.useState(null),[a,s]=r.useState(!0),[n,i]=r.useState(null);r.useEffect(()=>{let e=!0;return(async()=>{s(!0),i(null);const r=await async function(){var e,r,t;try{const{data:o,error:a}=await l.rpc("analytics_dashboard_metrics");if(a)throw a;if(!o)return h;const s="string"==typeof o?JSON.parse(o):o;return{totalEvents:null!=(e=s.totalEvents)?e:0,eventsLast7Days:null!=(r=s.eventsLast7Days)?r:0,activeStudentsLast30Days:null!=(t=s.activeStudentsLast30Days)?t:0,series:Array.isArray(s.series)?s.series:[],topEvents:Array.isArray(s.topEvents)?s.topEvents:[]}}catch(n){return h}}();e&&(r.series.length||r.topEvents.length||i("No analytics data has been recorded yet."),o(r),s(!1))})().catch(r=>{e&&(i(r instanceof Error?r.message:"Unable to load analytics"),s(!1))}),()=>{e=!1}},[]);const c=function({metrics:r,isLoading:t,error:o}){if(t)return e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Loading metrics‚Ä¶"});if(o)return e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:o});if(!r)return null;const a={display:"flex",gap:24,flexWrap:"wrap"},s=r.topEvents.map(r=>e.jsxs("li",{style:{marginBottom:8},children:[e.jsx("strong",{children:r.eventType}),e.jsxs("span",{style:{color:"var(--color-text-secondary)",marginLeft:8},children:[r.total.toLocaleString()," occurrences"]})]},r.eventType)),l=r.series.map(r=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontFamily:"var(--font-mono, monospace)"},children:[e.jsx("span",{children:r.date}),e.jsxs("span",{children:[r.events.toLocaleString()," events"]}),e.jsxs("span",{children:[r.uniqueActors.toLocaleString()," actors"]})]},r.date));let n,i;n=r.topEvents.length?e.jsx("ol",{style:{margin:0,paddingLeft:20},children:s}):e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No event distribution captured yet."});i=r.series.length?e.jsx("div",{style:{display:"grid",gap:8,maxHeight:240,overflowY:"auto",border:"1px solid var(--color-border)",borderRadius:8,padding:12},children:l}):e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No daily activity has been logged yet."});return e.jsxs("div",{style:{display:"grid",gap:16},children:[e.jsxs("div",{style:a,children:[e.jsx(x,{label:"Total Events",value:r.totalEvents.toLocaleString()}),e.jsx(x,{label:"Events (7d)",value:r.eventsLast7Days.toLocaleString()}),e.jsx(x,{label:"Active Students (30d)",value:r.activeStudentsLast30Days.toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{marginBottom:12,fontSize:16},children:"Top Events (30d)"}),n]}),e.jsxs("div",{children:[e.jsx("h3",{style:{marginBottom:12,fontSize:16},children:"Daily Activity (30d)"}),i]})]})}({metrics:t,isLoading:a,error:n});return e.jsxs("section",{style:u,"aria-labelledby":"analytics-pulse-heading",children:[e.jsxs("header",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[e.jsxs("div",{children:[e.jsx("h2",{id:"analytics-pulse-heading",style:{margin:0,fontSize:20},children:"Platform Analytics Pulse"}),e.jsx("p",{style:{margin:0,color:"var(--color-text-secondary)"},children:"Totals aggregate the last 30 days of tracked events."})]}),e.jsx("span",{style:{fontSize:24},children:"üìà"})]}),c]})}function x({label:r,value:t}){return e.jsxs("div",{style:{minWidth:160,padding:12,borderRadius:8,backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)"},children:[e.jsx("p",{style:{margin:0,fontSize:12,color:"var(--color-text-secondary)"},children:r}),e.jsx("p",{style:{margin:0,fontSize:20,fontWeight:600},children:t})]})}function p(){const[l,h]=r.useState(null),[u,x]=r.useState(!0);o("dashboard.view",{page:"admin-dashboard"}),r.useEffect(()=>{p()},[]);const p=async()=>{x(!0);try{const e=await a.get("/admin/dashboard");h(e)}catch(e){console.error("Failed to fetch dashboard data:",e),h(y())}finally{x(!1)}},y=()=>({overview:{totalUsers:{value:12458,change:12.5},activeCourses:{value:342,change:8.3},revenue:{value:45230,change:15.7},supportTickets:{value:23,change:-18.2}},userGrowth:[{label:"Jan",value:8500},{label:"Feb",value:9200},{label:"Mar",value:9800},{label:"Apr",value:10500},{label:"May",value:11200},{label:"Jun",value:12458}],courseEnrollments:[{label:"Web Dev",value:3420},{label:"Data Science",value:2890},{label:"Design",value:2340},{label:"Marketing",value:1980},{label:"Business",value:1560}],usersByRole:[{label:"Students",value:10890},{label:"Instructors",value:1234},{label:"Admins",value:334}],revenueByMonth:[{label:"Jan",value:32e3},{label:"Feb",value:35e3},{label:"Mar",value:38e3},{label:"Apr",value:41e3},{label:"May",value:43e3},{label:"Jun",value:45230}]});if(u)return e.jsx(n,{children:e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:400},children:e.jsx(s,{size:"large"})})});const m=l||y();return e.jsx(n,{children:e.jsxs("div",{style:{maxWidth:1400,margin:"0 auto",padding:32},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:32},children:[e.jsx("h1",{style:{fontSize:32,fontWeight:700},children:"Admin Analytics Dashboard"}),e.jsx("button",{onClick:p,style:{padding:"10px 20px",fontSize:14,border:"1px solid var(--color-border)",borderRadius:6,backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)",cursor:"pointer"},children:"üîÑ Refresh"})]}),e.jsx("div",{style:{marginBottom:40},children:e.jsx(g,{})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:20,marginBottom:40},children:[e.jsx(i,{title:"Total Users",value:m.overview.totalUsers.value.toLocaleString(),change:m.overview.totalUsers.change,icon:"üë•",color:"var(--color-primary)"}),e.jsx(i,{title:"Active Courses",value:m.overview.activeCourses.value.toLocaleString(),change:m.overview.activeCourses.change,icon:"üìö",color:"var(--color-success)"}),e.jsx(i,{title:"Revenue (MTD)",value:`$${m.overview.revenue.value.toLocaleString()}`,change:m.overview.revenue.change,icon:"üí∞",color:"var(--color-warning)"}),e.jsx(i,{title:"Support Tickets",value:m.overview.supportTickets.value.toLocaleString(),change:m.overview.supportTickets.change,icon:"üé´",color:"var(--color-danger)"})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(500px, 1fr))",gap:24,marginBottom:40},children:[e.jsxs("div",{style:{backgroundColor:"var(--color-card-bg)",padding:24,borderRadius:8,border:"1px solid var(--color-border)"},children:[e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"User Growth"}),e.jsx(c,{data:m.userGrowth,width:500,height:300,color:"var(--color-primary)"})]}),e.jsxs("div",{style:{backgroundColor:"var(--color-card-bg)",padding:24,borderRadius:8,border:"1px solid var(--color-border)"},children:[e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"Revenue Trend"}),e.jsx(c,{data:m.revenueByMonth,width:500,height:300,color:"var(--color-success)"})]}),e.jsxs("div",{style:{backgroundColor:"var(--color-card-bg)",padding:24,borderRadius:8,border:"1px solid var(--color-border)"},children:[e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"Top Courses by Enrollment"}),e.jsx(d,{data:m.courseEnrollments,width:500,height:300,color:"var(--color-info)"})]}),e.jsxs("div",{style:{backgroundColor:"var(--color-card-bg)",padding:24,borderRadius:8,border:"1px solid var(--color-border)"},children:[e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:20},children:"Users by Role"}),e.jsx(v,{data:m.usersByRole,width:500,height:300})]})]}),e.jsx("h2",{style:{fontSize:24,fontWeight:600,marginBottom:20},children:"Quick Actions"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:24},children:[e.jsxs(t,{to:"/user-management",style:{backgroundColor:"var(--color-card-bg)",padding:24,borderRadius:8,border:"1px solid var(--color-border)",textDecoration:"none",color:"inherit"},children:[e.jsx("div",{style:{fontSize:32,marginBottom:12},children:"üë•"}),e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"User Management"}),e.jsx("p",{style:{fontSize:14,color:"var(--color-text-secondary)"},children:"Manage users, roles, and permissions"})]}),e.jsxs(t,{to:"/course-builder",style:{backgroundColor:"var(--color-card-bg)",padding:24,borderRadius:8,border:"1px solid var(--color-border)",textDecoration:"none",color:"inherit"},children:[e.jsx("div",{style:{fontSize:32,marginBottom:12},children:"üìö"}),e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Course Management"}),e.jsx("p",{style:{fontSize:14,color:"var(--color-text-secondary)"},children:"Review and manage all courses"})]}),e.jsxs(t,{to:"/analytics",style:{backgroundColor:"var(--color-card-bg)",padding:24,borderRadius:8,border:"1px solid var(--color-border)",textDecoration:"none",color:"inherit"},children:[e.jsx("div",{style:{fontSize:32,marginBottom:12},children:"üìä"}),e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Detailed Analytics"}),e.jsx("p",{style:{fontSize:14,color:"var(--color-text-secondary)"},children:"View platform analytics and reports"})]}),e.jsxs(t,{to:"/settings",style:{backgroundColor:"var(--color-card-bg)",padding:24,borderRadius:8,border:"1px solid var(--color-border)",textDecoration:"none",color:"inherit"},children:[e.jsx("div",{style:{fontSize:32,marginBottom:12},children:"‚öôÔ∏è"}),e.jsx("h3",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Platform Settings"}),e.jsx("p",{style:{fontSize:14,color:"var(--brand-text-muted)"},children:"Configure platform settings"})]})]})]})})}export{p as default};
