import{r as e,j as t}from"./vendor-react-mXmGo1rS.js";import{supabase as s}from"./supabaseClient-mnOK5lWJ.js";import{A as r}from"./AppLayout-C3pbRaS2.js";import"./vendor-BU8AdXDg.js";import"./vendor-supabase-BOQaJsF3.js";import"./vendor-router-umqT_8ks.js";function a(){const[a,d]=e.useState(!0),[l,n]=e.useState([]),[i,c]=e.useState(null),[o,x]=e.useState([]),[u,h]=e.useState(null);e.useEffect(()=>{m()},[]),e.useEffect(()=>{i&&p(i)},[i]);const m=async()=>{if(!s)return h("Database service is not available"),void d(!1);try{d(!0),h(null);const{data:e,error:t}=await s.from("courses").select("*").order("title");if(t)throw t;n(e||[]),e&&e.length>0&&c(e[0].id)}catch(e){console.error("Error fetching courses:",e),h(e.message)}finally{d(!1)}},p=async e=>{if(!s)return h("Database service is not available"),void d(!1);try{d(!0),h(null);const{data:t,error:r}=await s.from("enrollments").select("user_id").eq("course_id",e);if(r)throw r;if(!t||0===t.length)return void x([]);const a=t.map(e=>e.user_id),{data:l,error:n}=await s.from("quiz_responses").select("\n          *,\n          quiz_questions (\n            id,\n            answer,\n            lesson_id,\n            lessons (\n              course_id\n            )\n          )\n        ").in("user_id",a);if(n)throw n;const i={};null==l||l.forEach(t=>{var s,r,a;const d=t.user_id;if((null==(r=null==(s=t.quiz_questions)?void 0:s.lessons)?void 0:r.course_id)!==e)return;i[d]||(i[d]={userId:d,correct:0,total:0});const l=t.answer===(null==(a=t.quiz_questions)?void 0:a.answer);i[d].total++,l&&i[d].correct++});const c=Object.values(i).map(e=>({...e,percentage:e.total>0?Math.round(e.correct/e.total*100):0,letterGrade:b(e.total>0?Math.round(e.correct/e.total*100):0)}));x(c)}catch(t){console.error("Error fetching student grades:",t),h(t.message)}finally{d(!1)}},b=e=>e>=90?"A":e>=80?"B":e>=70?"C":e>=60?"D":"F",g=o.length>0?Math.round(o.reduce((e,t)=>e+t.percentage,0)/o.length):0;return t.jsx(r,{children:t.jsxs("div",{className:"container mx-auto px-4 py-8",children:[t.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Instructor Grade Book"}),u&&t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:t.jsx("p",{className:"text-red-800",children:u})}),t.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Select Course"}),t.jsx("select",{value:i||"",onChange:e=>c(e.target.value),className:"w-full md:w-1/2 p-3 border rounded-lg focus:ring-2 focus:ring-brand-focus",children:l.map(e=>t.jsxs("option",{value:e.id,children:[e.code," - ",e.title]},e.id))})]}),a?t.jsxs("div",{className:"text-center py-12",children:[t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),t.jsx("p",{className:"mt-4 text-brand-text-muted",children:"Loading grades..."})]}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg shadow-lg p-6 text-white",children:[t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Class Statistics"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[t.jsx("div",{className:"text-3xl font-bold",children:o.length}),t.jsx("div",{className:"text-sm",children:"Total Students"})]}),t.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[t.jsxs("div",{className:"text-3xl font-bold",children:[g,"%"]}),t.jsx("div",{className:"text-sm",children:"Class Average"})]}),t.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[t.jsx("div",{className:"text-3xl font-bold",children:o.filter(e=>e.percentage>=70).length}),t.jsx("div",{className:"text-sm",children:"Passing Students"})]})]})]}),t.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[t.jsx("div",{className:"p-6 border-b",children:t.jsx("h2",{className:"text-2xl font-bold",children:"Student Grades"})}),0===o.length?t.jsx("div",{className:"p-6 text-center text-brand-text-light",children:t.jsx("p",{children:"No students enrolled in this course yet."})}):t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{className:"bg-brand-surface",children:t.jsxs("tr",{children:[t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-brand-text-light uppercase tracking-wider",children:"Student ID"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-brand-text-light uppercase tracking-wider",children:"Quizzes Completed"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-brand-text-light uppercase tracking-wider",children:"Correct Answers"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-brand-text-light uppercase tracking-wider",children:"Percentage"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-brand-text-light uppercase tracking-wider",children:"Letter Grade"}),t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-brand-text-light uppercase tracking-wider",children:"Status"})]})}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.map(e=>{return t.jsxs("tr",{className:"hover:bg-brand-surface",children:[t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-brand-text",children:[e.userId.substring(0,8),"..."]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-brand-text-light",children:e.total}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-brand-text-light",children:e.correct}),t.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-semibold text-brand-text",children:[e.percentage,"%"]}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:t.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-bold "+(s=e.percentage,s>=90?"bg-brand-surface text-brand-success":s>=80?"bg-brand-surface text-brand-info":s>=70?"bg-yellow-100 text-yellow-800":s>=60?"bg-brand-surface text-brand-warning":"bg-brand-surface text-red-800"),children:e.letterGrade})}),t.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.percentage>=70?t.jsx("span",{className:"px-3 py-1 bg-brand-surface text-brand-success rounded-full text-xs font-semibold",children:"Passing"}):t.jsx("span",{className:"px-3 py-1 bg-brand-surface text-red-800 rounded-full text-xs font-semibold",children:"At Risk"})})]},e.userId);var s})})]})})]}),o.length>0&&t.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[t.jsx("h3",{className:"text-xl font-bold mb-4",children:"Grade Distribution"}),t.jsx("div",{className:"grid grid-cols-5 gap-4",children:["A","B","C","D","F"].map(e=>{const s=o.filter(t=>t.letterGrade===e).length,r=Math.round(s/o.length*100);return t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-3xl font-bold text-brand-text",children:s}),t.jsxs("div",{className:"text-sm text-brand-text-muted",children:[e," (",r,"%)"]})]},e)})})]})]})]})})}export{a as default};
