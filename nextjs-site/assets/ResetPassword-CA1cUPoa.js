import{r as e,j as s,ap as t}from"./vendor-react-mXmGo1rS.js";import{c as r,b as a}from"./vendor-router-umqT_8ks.js";import{supabase as n}from"./supabaseClient-mnOK5lWJ.js";import"./vendor-BU8AdXDg.js";import"./vendor-supabase-BOQaJsF3.js";function d(){const[d]=r(),l=a(),[i,o]=e.useState(""),[c,m]=e.useState(""),[u,x]=e.useState(!1),[b,h]=e.useState(""),[f,p]=e.useState(!1),[w,g]=e.useState(!0),[j,N]=e.useState(!1),v=d.get("access_token"),y=d.get("type");e.useEffect(()=>{k()},[v,y]);const k=async()=>{if(n){if(g(!0),"recovery"===y&&v)try{const{error:e}=await n.auth.setSession({access_token:v,refresh_token:d.get("refresh_token")||""});if(e)throw e;N(!0)}catch(e){console.error("Token validation error:",e),N(!1)}else N(!1);g(!1)}};return w?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-brand-surface",children:s.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),s.jsx("p",{className:"text-brand-text-muted",children:"Validating reset link..."})]})}):j?f?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-brand-surface",children:s.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[s.jsx("div",{className:"text-green-500 text-4xl mb-4",children:"✓"}),s.jsx("h2",{className:"text-2xl font-bold text-brand-text mb-2",children:"Password Reset Successful"}),s.jsx("p",{className:"text-brand-text-muted",children:"Redirecting to login..."})]})}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-brand-surface",children:s.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-brand-info/10 rounded-full mb-4",children:s.jsx(t,{className:"h-8 w-8 text-brand-info"})}),s.jsx("h2",{className:"text-2xl font-bold text-brand-text",children:"Reset Your Password"}),s.jsx("p",{className:"text-brand-text-muted mt-2",children:"Enter your new password below"})]}),s.jsxs("form",{onSubmit:async e=>{if(n)if(e.preventDefault(),h(""),i===c)if(i.length<8)h("Password must be at least 8 characters");else{x(!0);try{const{error:e}=await n.auth.updateUser({password:i});if(e)throw e;p(!0),await n.auth.signOut(),setTimeout(()=>l("/auth/login"),2e3)}catch(s){h(s.message||"Failed to reset password")}finally{x(!1)}}else h("Passwords do not match")},className:"space-y-4",children:[b&&s.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:b}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"New Password"}),s.jsx("input",{type:"password","aria-label":"password input",value:i,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border border-brand-border rounded-lg focus:ring-2 focus:ring-brand-info focus:border-transparent",placeholder:"Enter new password",required:!0,minLength:8})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-brand-text mb-2",children:"Confirm Password"}),s.jsx("input",{type:"password","aria-label":"password input",value:c,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 border border-brand-border rounded-lg focus:ring-2 focus:ring-brand-info focus:border-transparent",placeholder:"Confirm new password",required:!0,minLength:8})]}),s.jsx("button",{type:"submit",disabled:u,className:"w-full btn",children:u?"Resetting...":"Reset Password"})]})]})}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-brand-surface",children:s.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[s.jsx("div",{className:"text-red-500 text-4xl mb-4",children:"⚠️"}),s.jsx("h2",{className:"text-2xl font-bold text-brand-text mb-2",children:"Invalid Reset Link"}),s.jsx("p",{className:"text-brand-text-muted mb-6",children:"This password reset link is invalid or has expired."}),s.jsx("button",{onClick:()=>l("/auth/forgot-password"),className:"btn",children:"Request New Link"})]})})}export{d as default};
