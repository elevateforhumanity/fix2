import{r as e,j as s}from"./vendor-react-C-ZQNdj3.js";import{supabase as t}from"./supabaseClient-DCQoDyvc.js";import{A as r}from"./AppLayout-DjgAzEIN.js";import"./vendor-Da1LjC7-.js";import"./vendor-supabase-C00Cu5KO.js";import"./vendor-router-CQjfSXV_.js";function l(){const[l,d]=e.useState(!0),[n,a]=e.useState([]),[i,c]=e.useState([]),[o,x]=e.useState(null);e.useEffect(()=>{m()},[]);const m=async()=>{if(!t)return x("Database service is not available"),void d(!1);try{d(!0),x(null);const{data:{user:e}}=await t.auth.getUser();if(!e)return void x("Please log in to view your grades");const{data:s,error:r}=await t.from("enrollments").select("\n          *,\n          courses (\n            id,\n            title,\n            code,\n            program_id\n          )\n        ").eq("user_id",e.id);if(r)throw r;c(s||[]);const{data:l,error:n}=await t.from("quiz_responses").select("\n          *,\n          quiz_questions (\n            id,\n            answer,\n            lesson_id,\n            lessons (\n              course_id,\n              title\n            )\n          )\n        ").eq("user_id",e.id);if(n)throw n;const i={};null==l||l.forEach(e=>{var s,t,r;const l=null==(t=null==(s=e.quiz_questions)?void 0:s.lessons)?void 0:t.course_id;if(!l)return;i[l]||(i[l]={correct:0,total:0,quizzes:[]});const d=e.answer===(null==(r=e.quiz_questions)?void 0:r.answer);i[l].total++,d&&i[l].correct++});const o=Object.entries(i).map(([e,s])=>({courseId:e,percentage:s.total>0?Math.round(s.correct/s.total*100):0,correct:s.correct,total:s.total}));a(o)}catch(e){console.error("Error fetching student grades:",e),x(e.message)}finally{d(!1)}};return s.jsx(r,{children:s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"My Grades"}),o&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:s.jsx("p",{className:"text-red-800",children:o})}),l?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-brown-600",children:"Loading grades..."})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-lg p-6 text-white",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Academic Summary"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[s.jsx("div",{className:"text-3xl font-bold",children:i.length}),s.jsx("div",{className:"text-sm",children:"Enrolled Courses"})]}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[s.jsx("div",{className:"text-3xl font-bold",children:n.reduce((e,s)=>e+s.total,0)}),s.jsx("div",{className:"text-sm",children:"Quizzes Completed"})]}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[s.jsxs("div",{className:"text-3xl font-bold",children:[n.length>0?Math.round(n.reduce((e,s)=>e+s.percentage,0)/n.length):0,"%"]}),s.jsx("div",{className:"text-sm",children:"Average Grade"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow",children:[s.jsx("div",{className:"p-6 border-b",children:s.jsx("h2",{className:"text-2xl font-bold",children:"Course Grades"})}),0===i.length?s.jsxs("div",{className:"p-6 text-center text-brown-500",children:[s.jsx("p",{children:"You are not enrolled in any courses yet."}),s.jsx("a",{href:"/programs",className:"text-green-600 hover:underline mt-2 inline-block",children:"Browse Programs"})]}):s.jsx("div",{className:"divide-y",children:i.map(e=>{var t,r;const l=n.find(s=>{var t;return s.courseId===(null==(t=e.courses)?void 0:t.id)}),d=(null==l?void 0:l.percentage)||0,a=(e=>e>=90?"A":e>=80?"B":e>=70?"C":e>=60?"D":"F")(d),i=(e=>e>=90||e>=80?"text-green-600":e>=70?"text-yellow-600":e>=60?"text-orange-600":"text-red-600")(d);return s.jsx("div",{className:"p-6 hover:bg-beige-50 transition",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold text-brown-900",children:(null==(t=e.courses)?void 0:t.title)||"Unknown Course"}),s.jsx("p",{className:"text-sm text-brown-500",children:null==(r=e.courses)?void 0:r.code}),l&&s.jsxs("p",{className:"text-sm text-brown-600 mt-2",children:[l.correct," / ",l.total," ","quizzes correct"]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:`text-4xl font-bold ${i}`,children:a}),s.jsxs("div",{className:"text-lg text-brown-600",children:[d,"%"]}),l?s.jsx("div",{className:"mt-2",children:d>=70?s.jsx("span",{className:"px-3 py-1 bg-beige-50 text-green-600 rounded-full text-xs font-semibold",children:"Passing"}):s.jsx("span",{className:"px-3 py-1 bg-beige-50 text-red-800 rounded-full text-xs font-semibold",children:"Needs Improvement"})}):s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:"px-3 py-1 bg-beige-100 text-brown-600 rounded-full text-xs font-semibold",children:"No Grades Yet"})})]})]})},e.course_id)})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Grading Scale"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:"A"}),s.jsx("div",{className:"text-sm text-brown-600",children:"90-100%"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-green-600",children:"B"}),s.jsx("div",{className:"text-sm text-brown-600",children:"80-89%"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:"C"}),s.jsx("div",{className:"text-sm text-brown-600",children:"70-79%"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:"D"}),s.jsx("div",{className:"text-sm text-brown-600",children:"60-69%"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:"F"}),s.jsx("div",{className:"text-sm text-brown-600",children:"0-59%"})]})]})]})]})]})})}export{l as default};
