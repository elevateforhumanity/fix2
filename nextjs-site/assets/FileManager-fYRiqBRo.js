import{r as e,j as r,d as t}from"./vendor-react-mXmGo1rS.js";import"./vendor-BU8AdXDg.js";function o({onUpload:t,folderId:o=null,maxSize:n=104857600}){const[a,i]=e.useState(!1),[d,l]=e.useState(!1),[s,c]=e.useState(0),m=e.useRef(null),p=async e=>{for(const r of e)r.size>n?alert(`File ${r.name} is too large. Maximum size is ${f(n)}`):await h(r)},h=async e=>{l(!0),c(0);try{const r=new FormData;r.append("file",e),o&&r.append("folderId",o);const n=setInterval(()=>{c(e=>Math.min(e+10,90))},200),a=await fetch("/api/files/upload",{method:"POST",body:r});if(clearInterval(n),c(100),!a.ok)throw new Error("Upload failed");const i=await a.json();t&&t(i),setTimeout(()=>{l(!1),c(0)},1e3)}catch(r){console.error("Upload error:",r),alert("Failed to upload file"),l(!1),c(0)}},f=e=>{if(0===e)return"0 Bytes";const r=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,r)*100)/100+" "+["Bytes","KB","MB","GB"][r]};return r.jsxs("div",{children:[r.jsxs("div",{onDragOver:e=>{e.preventDefault(),i(!0)},onDragLeave:()=>{i(!1)},onDrop:async e=>{e.preventDefault(),i(!1);const r=Array.from(e.dataTransfer.files);await p(r)},onClick:()=>{var e;return null==(e=m.current)?void 0:e.click()},style:{border:"2px dashed "+(a?"var(--brand-info)":"var(--brand-border-dark)"),borderRadius:"0.5rem",padding:"3rem 2rem",textAlign:"center",cursor:"pointer",backgroundColor:"var(--brand-surface)",transition:"all 0.2s"},children:[r.jsx("input",{ref:m,type:"file","aria-label":"file input",multiple:!0,onChange:async e=>{const r=Array.from(e.target.files);await p(r)},style:{display:"none"}}),d?r.jsxs("div",{children:[r.jsx("div",{style:{width:"48px",height:"48px",border:"4px solid var(--brand-border)",borderTopColor:"var(--brand-info)",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1rem"}}),r.jsxs("p",{style:{color:"var(--brand-text-muted)",marginBottom:"0.5rem"},children:["Uploading... ",s,"%"]}),r.jsx("div",{style:{width:"100%",maxWidth:"300px",height:"8px",backgroundColor:"var(--brand-border)",borderRadius:"4px",margin:"0 auto",overflow:"hidden"},children:r.jsx("div",{style:{width:`${s}%`,height:"100%",backgroundColor:"var(--brand-info)",transition:"width 0.3s"}})})]}):r.jsxs(r.Fragment,{children:[r.jsx("svg",{style:{width:"48px",height:"48px",margin:"0 auto 1rem",color:"var(--brand-text-light)"},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),r.jsx("p",{style:{fontSize:"1.125rem",fontWeight:"500",color:"var(--brand-text)",marginBottom:"0.5rem"},children:a?"Drop files here":"Click to upload or drag and drop"}),r.jsxs("p",{style:{fontSize:"0.875rem",color:"var(--brand-text-muted)"},children:["Maximum file size: ",f(n)]})]})]}),r.jsx("style",{children:"\n        @keyframes spin {\n          to { transform: rotate(360deg); }\n        }\n      "})]})}function n(){const[n,a]=e.useState([]),[i,d]=e.useState(null),[l,s]=e.useState([{id:null,name:"My Drive"}]),[c,m]=e.useState("grid"),[p,h]=e.useState([]),[f,u]=e.useState(!1),[g,x]=e.useState(null);e.useEffect(()=>{y(),b()},[i]);const y=async()=>{try{const e=await fetch(`/api/files?folderId=${i||""}`),r=await e.json();a(r)}catch(e){console.error("Failed to load files:",e)}},b=async()=>{try{const e=await fetch("/api/files/quota"),r=await e.json();x(r)}catch(e){console.error("Failed to load storage quota:",e)}},v=e=>{if(0===e)return"0 Bytes";const r=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,r)*100)/100+" "+["Bytes","KB","MB","GB"][r]},j=e=>{var r,t,o,n,a,i,d;return e.isFolder?"ðŸ“":(null==(r=e.mimeType)?void 0:r.startsWith("image/"))?"ðŸ–¼ï¸":(null==(t=e.mimeType)?void 0:t.startsWith("video/"))?"ðŸŽ¥":(null==(o=e.mimeType)?void 0:o.startsWith("audio/"))?"ðŸŽµ":(null==(n=e.mimeType)?void 0:n.includes("pdf"))?"ðŸ“„":(null==(a=e.mimeType)?void 0:a.includes("word"))?"ðŸ“":(null==(i=e.mimeType)?void 0:i.includes("sheet"))?"ðŸ“Š":(null==(d=e.mimeType)?void 0:d.includes("presentation"))?"ðŸ“½ï¸":"ðŸ“„"};return r.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"var(--brand-surface)"},children:[r.jsx("div",{style:{backgroundColor:"#fff",borderBottom:"1px solid var(--brand-border)",padding:"1rem 2rem"},children:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",maxWidth:"1400px",margin:"0 auto"},children:[r.jsx("h1",{style:{fontSize:"1.5rem",fontWeight:"600",margin:0},children:"Elevate Drive"}),r.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[g&&r.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--brand-text-muted)"},children:[v(g.used)," of"," ",-1===g.total?"Unlimited":v(g.total)," ","used"]}),r.jsx("button",{onClick:()=>u(!f),style:{padding:"0.5rem 1rem",backgroundColor:"var(--brand-info)",color:"#fff",border:"none",borderRadius:"0.375rem",cursor:"pointer",fontWeight:"500"},children:"+ Upload"}),r.jsx("button",{onClick:async()=>{const e=prompt("Folder name:");if(e)try{(await fetch("/api/files/folder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,parentFolderId:i})})).ok&&y()}catch(r){console.error("Failed to create folder:",r)}},style:{padding:"0.5rem 1rem",backgroundColor:"#fff",color:"var(--brand-text)",border:"1px solid var(--brand-border-dark)",borderRadius:"0.375rem",cursor:"pointer"},children:"+ New Folder"})]})]})}),r.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",padding:"2rem"},children:[r.jsx("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center",marginBottom:"1.5rem",fontSize:"0.875rem"},children:l.map((e,o)=>r.jsxs(t.Fragment,{children:[r.jsx("button",{onClick:()=>(e=>{const r=l.slice(0,e+1);s(r),d(r[r.length-1].id)})(o),style:{background:"none",border:"none",color:o===l.length-1?"var(--brand-text)":"var(--brand-info)",cursor:"pointer",fontWeight:o===l.length-1?"600":"400"},children:e.name}),o<l.length-1&&r.jsx("span",{style:{color:"var(--brand-text-light)"},children:"/"})]},e.id||"root"))}),f&&r.jsx("div",{style:{marginBottom:"2rem"},children:r.jsx(o,{onUpload:e=>{a([...n,e]),u(!1),b()},folderId:i})}),g&&-1!==g.total&&r.jsxs("div",{style:{marginBottom:"1.5rem",padding:"1rem",backgroundColor:"#fff",borderRadius:"0.5rem",border:"1px solid var(--brand-border)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.5rem",fontSize:"0.875rem"},children:[r.jsx("span",{children:"Storage used"}),r.jsxs("span",{children:[g.percentage.toFixed(1),"%"]})]}),r.jsx("div",{style:{width:"100%",height:"8px",backgroundColor:"var(--brand-border)",borderRadius:"4px",overflow:"hidden"},children:r.jsx("div",{style:{width:`${Math.min(g.percentage,100)}%`,height:"100%",backgroundColor:g.percentage>90?"var(--brand-danger)":"var(--brand-info)",transition:"width 0.3s"}})})]}),0===n.length?r.jsxs("div",{style:{textAlign:"center",padding:"4rem 2rem",color:"var(--brand-text-muted)"},children:[r.jsx("p",{style:{fontSize:"1.125rem",marginBottom:"0.5rem"},children:"This folder is empty"}),r.jsx("p",{style:{fontSize:"0.875rem"},children:"Upload files or create a new folder to get started"})]}):r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"1rem"},children:n.map(e=>r.jsxs("div",{style:{backgroundColor:"#fff",border:"1px solid var(--brand-border)",borderRadius:"0.5rem",padding:"1rem",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 4px 6px rgba(0,0,0,0.1)",e.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="none",e.currentTarget.style.transform="translateY(0)"},children:[r.jsxs("div",{onClick:()=>(e=>{e.isFolder?(d(e.id),s([...l,{id:e.id,name:e.name}])):window.open(`/api/files/${e.id}/download`,"_blank")})(e),children:[r.jsx("div",{style:{fontSize:"3rem",textAlign:"center",marginBottom:"0.5rem"},children:j(e)}),r.jsx("div",{style:{fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.25rem",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),r.jsx("div",{style:{fontSize:"0.75rem",color:"var(--brand-text-muted)"},children:!e.isFolder&&v(e.size)})]}),r.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.75rem",paddingTop:"0.75rem",borderTop:"1px solid var(--brand-border)"},children:[r.jsx("button",{onClick:r=>{r.stopPropagation(),(async e=>{const r=prompt("Enter email address to share with:");if(r)try{(await fetch(`/api/files/${e}/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,permission:"read"})})).ok&&alert("File shared successfully")}catch(t){console.error("Failed to share file:",t)}})(e.id)},style:{flex:1,padding:"0.25rem",fontSize:"0.75rem",backgroundColor:"transparent",border:"1px solid var(--brand-border-dark)",borderRadius:"0.25rem",cursor:"pointer"},children:"Share"}),r.jsx("button",{onClick:r=>{r.stopPropagation(),(async e=>{if(confirm("Are you sure you want to delete this file?"))try{(await fetch(`/api/files/${e}`,{method:"DELETE"})).ok&&(a(n.filter(r=>r.id!==e)),b())}catch(r){console.error("Failed to delete file:",r)}})(e.id)},style:{flex:1,padding:"0.25rem",fontSize:"0.75rem",backgroundColor:"transparent",color:"var(--brand-danger)",border:"1px solid var(--brand-danger)",borderRadius:"0.25rem",cursor:"pointer"},children:"Delete"})]})]},e.id))})]})]})}export{n as FileManager,n as default};
