import{r as e,j as s,h as a,B as t,i as l,k as r,Y as n,T as o,L as i,l as d,m as c,n as h}from"./vendor-react-C-ZQNdj3.js";import{A as x}from"./AppLayout-DjgAzEIN.js";import"./vendor-Da1LjC7-.js";import"./vendor-router-CQjfSXV_.js";function m(){var m,u,p,g,j,b;const[y,N]=e.useState(!1),[f,v]=e.useState([]),[w,k]=e.useState(!1),[S,$]=e.useState(""),[C,_]=e.useState("generate_page"),[T,E]=e.useState("{}"),[O,R]=e.useState(null),[L,D]=e.useState(new Date(Date.now()-864e5).toISOString().slice(0,10)),[A,K]=e.useState((new Date).toISOString().slice(0,10)),[I,J]=e.useState(""),[P,F]=e.useState(""),[z,M]=e.useState([]),[G,U]=e.useState(null),[B,H]=e.useState(""),[Y,W]=e.useState(30),[q,Q]=e.useState(null),[V,X]=e.useState(""),[Z,ee]=e.useState(""),[se,ae]=e.useState(""),te="https://efh-autopilot-orchestrator.workers.dev",le="https://efh-autopilot-analyzer.workers.dev",re=(e,s="info")=>{H(e),setTimeout(()=>H(""),3e3)};async function ne(){k(!0);try{const e=await fetch(`${te}/autopilot/list`),s=await e.json();v(s.autopilots||[]),re("Autopilots loaded","success")}catch(e){re(`Error: ${e}`,"error"),$(`âŒ Error fetching autopilots: ${e}`)}k(!1)}async function oe(){k(!0);try{const e=await fetch(`${le}/logs/stats?days=${Y}`),s=await e.json();Q(s),re("Stats loaded","success")}catch(e){re(`Error: ${e}`,"error")}k(!1)}const ie=e=>{navigator.clipboard.writeText(e),re("Copied to clipboard","success")};e.useEffect(()=>{ne(),oe()},[]),e.useEffect(()=>{oe()},[Y]);const de=y?"bg-gray-900 text-white":"bg-beige-50 text-brown-900",ce=y?"bg-gray-800 border-gray-700":"bg-white border-brown-200",he=y?"bg-gray-700 border-gray-600 text-white":"bg-white border-brown-300 text-brown-900";return s.jsx(x,{children:s.jsxs("div",{className:`min-h-screen p-6 ${de}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h1",{className:"text-3xl font-bold text-red-600",children:"âš™ï¸ Autopilot Admin Console"}),s.jsx("button",{onClick:()=>N(!y),className:"px-4 py-2 rounded bg-gray-700 text-white hover:bg-gray-600",children:y?"â˜€ï¸ Light":"ðŸŒ™ Dark"})]}),B&&s.jsx("div",{className:"fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg z-50",children:B}),s.jsxs("div",{className:`mb-6 p-4 border rounded-lg shadow ${ce}`,children:[s.jsx("h2",{className:"font-semibold mb-4 text-green-600 text-xl",children:"ðŸŽ¯ Orchestrator"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Registered Autopilots"}),w&&s.jsx("p",{children:"Loading..."}),!w&&0===f.length&&s.jsx("p",{className:"text-brown-500",children:"No autopilots registered yet."}),!w&&f.length>0&&s.jsx("div",{className:"overflow-x-auto",children:s.jsxs("table",{className:"w-full text-sm border-collapse",children:[s.jsx("thead",{children:s.jsxs("tr",{className:y?"bg-gray-700":"bg-beige-100",children:[s.jsx("th",{className:"p-2 text-left",children:"Name"}),s.jsx("th",{className:"p-2 text-left",children:"Capabilities"}),s.jsx("th",{className:"p-2 text-left",children:"Endpoint"})]})}),s.jsx("tbody",{children:f.map(e=>s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"p-2 font-medium text-orange-600",children:e.name}),s.jsx("td",{className:"p-2",children:(e.capabilities||[]).join(", ")}),s.jsxs("td",{className:"p-2 text-green-600 text-xs",children:[e.endpoint,s.jsx("button",{onClick:()=>ie(e.endpoint),className:"ml-2 text-brown-500 hover:text-green-600",children:"ðŸ“‹"})]})]},e.name))})]})})]}),s.jsxs("div",{className:"grid md:grid-cols-4 gap-4 mb-4",children:[s.jsx("button",{onClick:async function(){$("Running diagnostics...");try{const e=await fetch(`${te}/autopilot/diagnose`),s=await e.json();R(s),$(JSON.stringify(s,null,2)),re("Diagnostics complete","success")}catch(e){re(`Error: ${e}`,"error"),$(`âŒ Error running diagnostics: ${e}`)}},className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"ðŸ” Diagnostics"}),s.jsx("button",{onClick:async function(){$("Healing infrastructure...");try{const e=await fetch(`${te}/autopilot/ensure-infra`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({want:{kvNamespaces:["REGISTRY","AI_EMPLOYEE_LOGS","LOGS","SUMMARIES"],r2Buckets:["efh-assets","efh-images","efh-pages"]}})}),s=await e.json();$(JSON.stringify(s,null,2)),re("Infrastructure healed","success")}catch(e){re(`Error: ${e}`,"error"),$(`âŒ Error healing infrastructure: ${e}`)}},className:"bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600",children:"ðŸ©º Heal Infra"}),s.jsx("button",{onClick:ne,className:"bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-800",children:"ðŸ” Refresh"}),s.jsx("button",{onClick:()=>ie(te),className:"bg-brown-600 text-white px-4 py-2 rounded hover:bg-brown-600-hover",children:"ðŸ“‹ Copy URL"})]}),s.jsxs("div",{className:`p-4 border rounded mb-4 ${ce}`,children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Register New Autopilot"}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-3",children:[s.jsx("input",{className:`border p-2 rounded ${he}`,placeholder:"Name (e.g., ai-employee)",value:V,onChange:e=>X(e.target.value)}),s.jsx("input",{className:`border p-2 rounded ${he}`,placeholder:"Endpoint URL",value:Z,onChange:e=>ee(e.target.value)}),s.jsx("input",{className:`border p-2 rounded ${he}`,placeholder:"Capabilities (comma-separated)",value:se,onChange:e=>ae(e.target.value)})]}),s.jsx("button",{onClick:async function(){if(V&&Z&&se)try{const e=se.split(",").map(e=>e.trim()),s=await fetch(`${te}/autopilot/registry`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:V,endpoint:Z,capabilities:e})}),a=await s.json();$(JSON.stringify(a,null,2)),re("Autopilot registered","success"),X(""),ee(""),ae(""),ne()}catch(e){re(`Error: ${e}`,"error")}else re("Fill all fields","error")},className:"bg-green-600 text-white px-4 py-2 mt-3 rounded hover:bg-green-700",children:"âž• Register"})]}),O&&s.jsxs("div",{className:`p-4 border rounded mb-4 ${ce}`,children:[s.jsx("h3",{className:"font-semibold text-lg mb-2 text-green-700",children:"Diagnostic Summary"}),s.jsx("pre",{className:"text-xs overflow-auto max-h-64",children:JSON.stringify(O,null,2)})]}),s.jsxs("div",{className:`p-4 border rounded ${ce}`,children:[s.jsx("h3",{className:"font-semibold mb-2",children:"Run Task"}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block font-medium mb-1",children:"Task Name"}),s.jsxs("select",{className:`border p-2 w-full rounded ${he}`,value:C,onChange:e=>_(e.target.value),children:[s.jsx("option",{value:"generate_page",children:"Generate Page"}),s.jsx("option",{value:"deploy_page",children:"Deploy Page"}),s.jsx("option",{value:"generate_asset",children:"Generate Asset"}),s.jsx("option",{value:"process_email",children:"Process Email"}),s.jsx("option",{value:"create_lead",children:"Create Lead"}),s.jsx("option",{value:"send_followup",children:"Send Follow-up"}),s.jsx("option",{value:"make_checkout",children:"Make Checkout"}),s.jsx("option",{value:"enroll_student",children:"Enroll Student"}),s.jsx("option",{value:"run_payout_batch",children:"Run Payout Batch"}),s.jsx("option",{value:"pay_affiliate_now",children:"Pay Affiliate Now"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block font-medium mb-1",children:"Meta (JSON)"}),s.jsx("textarea",{className:`border p-2 rounded w-full h-20 font-mono text-xs ${he}`,value:T,onChange:e=>E(e.target.value),placeholder:'{"pageType": "home"}'})]})]}),s.jsx("button",{onClick:async function(){$("Running task...");try{const e=JSON.parse(T||"{}"),s=await fetch(`${te}/autopilot/plan`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({task:C,meta:e})}),a=await s.json();$(JSON.stringify(a,null,2)),re("Task executed","success")}catch(e){re(`Error: ${e}`,"error"),$(`âŒ Error running task: ${e}`)}},className:"bg-green-600 text-white px-4 py-2 mt-3 rounded hover:bg-green-700",children:"ðŸš€ Run Task"})]})]}),s.jsxs("div",{className:`mb-6 p-4 border rounded-lg shadow ${ce}`,children:[s.jsx("h2",{className:"font-semibold mb-4 text-green-600 text-xl",children:"ðŸ“Š Log Analyzer"}),s.jsxs("div",{className:"grid md:grid-cols-5 gap-3 mb-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm",children:"From"}),s.jsx("input",{type:"date","aria-label":"date input",className:`border p-2 rounded w-full ${he}`,value:L,onChange:e=>D(e.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm",children:"To"}),s.jsx("input",{type:"date","aria-label":"date input",className:`border p-2 rounded w-full ${he}`,value:A,onChange:e=>K(e.target.value)})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm",children:"Capability"}),s.jsx("input",{className:`border p-2 rounded w-full ${he}`,value:I,onChange:e=>J(e.target.value),placeholder:"e.g. payouts.batch.run"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm",children:"Task"}),s.jsx("input",{className:`border p-2 rounded w-full ${he}`,value:P,onChange:e=>F(e.target.value),placeholder:"e.g. run_payout_batch"})]}),s.jsx("div",{className:"flex items-end gap-2",children:s.jsx("button",{onClick:async function(){k(!0);const e=new URLSearchParams({from:L,to:A,...I?{cap:I}:{},...P?{task:P}:{}});try{const s=await fetch(`${le}/logs/list?${e}`),a=await s.json();M(a.logs||[]),re("Logs loaded","success")}catch(s){re(`Error: ${s}`,"error")}k(!1)},className:"bg-gray-700 text-white px-3 py-2 rounded w-full",children:"Refresh"})})]}),s.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[s.jsx("button",{onClick:async function(){k(!0),H("Summarizingâ€¦");try{const e=await fetch(`${le}/logs/summarize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({from:L,to:A})}),s=await e.json();U(s),re("Summary generated","success")}catch(e){re(`Error: ${e}`,"error")}H(""),k(!1)},className:"bg-green-600 text-white px-3 py-2 rounded",children:"AI Summarize"}),s.jsx("button",{onClick:async function(){try{const e=await fetch(`${le}/logs/summary?date=${A}`),s=await e.json();U(s),re("Daily summary loaded","success")}catch(e){re(`Error: ${e}`,"error")}},className:"bg-orange-500 text-white px-3 py-2 rounded",children:"Load Daily Digest"}),s.jsx("button",{onClick:()=>ie(le),className:"bg-brown-600 text-white px-3 py-2 rounded",children:"ðŸ“‹ Copy URL"}),w&&s.jsx("span",{className:"text-sm text-brown-500",children:"Workingâ€¦"})]}),G&&s.jsxs("div",{className:`p-4 border rounded mb-6 shadow ${ce}`,children:[s.jsxs("h2",{className:"font-semibold text-lg text-green-600",children:["Summary: ",G.date]}),s.jsxs("p",{className:"text-sm text-brown-600 mb-2",children:["OK: ",null!=(u=null==(m=G.counts)?void 0:m.ok)?u:G.n_ok," Â· Fail:"," ",null!=(g=null==(p=G.counts)?void 0:p.fail)?g:G.n_fail]}),s.jsx("div",{className:"prose max-w-none",dangerouslySetInnerHTML:{__html:(G.summary_markdown||"").replace(/\n/g,"<br/>")}}),(null==(j=G.highlights)?void 0:j.length)?s.jsx("ul",{className:"list-disc pl-6 mt-2",children:G.highlights.map((e,a)=>s.jsx("li",{children:e},a))}):null,(null==(b=G.next_actions)?void 0:b.length)?s.jsxs(s.Fragment,{children:[s.jsx("h3",{className:"font-semibold mt-3",children:"Next actions"}),s.jsx("ul",{className:"list-disc pl-6",children:G.next_actions.map((e,a)=>s.jsx("li",{children:e},a))})]}):null]}),s.jsx("div",{className:"overflow-x-auto border rounded",children:s.jsxs("table",{className:"min-w-full text-sm",children:[s.jsx("thead",{className:y?"bg-gray-700":"bg-beige-100",children:s.jsxs("tr",{children:[s.jsx("th",{className:"p-2 text-left",children:"Time"}),s.jsx("th",{className:"p-2 text-left",children:"Autopilot"}),s.jsx("th",{className:"p-2 text-left",children:"Task"}),s.jsx("th",{className:"p-2 text-left",children:"Capability"}),s.jsx("th",{className:"p-2 text-left",children:"OK"}),s.jsx("th",{className:"p-2 text-left",children:"Level"})]})}),s.jsxs("tbody",{children:[z.map((e,a)=>s.jsxs("tr",{className:"border-t",children:[s.jsx("td",{className:"p-2",children:new Date(e.ts).toLocaleString()}),s.jsx("td",{className:"p-2",children:e.autopilot}),s.jsx("td",{className:"p-2",children:e.task}),s.jsx("td",{className:"p-2",children:e.capability}),s.jsx("td",{className:"p-2 "+(e.ok?"text-green-700":"text-red-600"),children:e.ok?"yes":"no"}),s.jsx("td",{className:"p-2",children:e.level})]},a)),!z.length&&s.jsx("tr",{children:s.jsx("td",{className:"p-4 text-center text-brown-500",colSpan:6,children:"No events"})})]})]})})]}),s.jsxs("div",{className:`mb-6 p-4 border rounded-lg shadow ${ce}`,children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("h2",{className:"text-2xl font-bold text-red-600",children:"ðŸ“ˆ Trends"}),s.jsxs("select",{className:`border p-2 rounded ${he}`,value:Y,onChange:e=>W(Number(e.target.value)),children:[s.jsx("option",{value:7,children:"7 days"}),s.jsx("option",{value:14,children:"14 days"}),s.jsx("option",{value:30,children:"30 days"}),s.jsx("option",{value:60,children:"60 days"})]})]}),q&&s.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[s.jsxs("div",{className:`border rounded-lg p-4 shadow ${ce}`,children:[s.jsx("h3",{className:"font-semibold mb-2 text-green-600",children:"Daily OK vs Fail"}),s.jsx(a,{width:"100%",height:260,children:s.jsxs(t,{data:q.daily,children:[s.jsx(l,{strokeDasharray:"3 3"}),s.jsx(r,{dataKey:"day",hide:!0}),s.jsx(n,{}),s.jsx(o,{}),s.jsx(i,{}),s.jsx(d,{dataKey:"ok",stackId:"a",fill:"'#00a544'"}),s.jsx(d,{dataKey:"fail",stackId:"a",fill:"'#dc2626'"})]})}),s.jsxs("p",{className:"text-xs text-brown-500 mt-1",children:["Range: ",q.range.start," â†’ ",q.range.end]})]}),s.jsxs("div",{className:`border rounded-lg p-4 shadow ${ce}`,children:[s.jsx("h3",{className:"font-semibold mb-2 text-green-600",children:"% Failure Rate"}),s.jsx(a,{width:"100%",height:260,children:s.jsxs(c,{data:q.daily,children:[s.jsx(l,{strokeDasharray:"3 3"}),s.jsx(r,{dataKey:"day",hide:!0}),s.jsx(n,{domain:[0,"auto"]}),s.jsx(o,{}),s.jsx(h,{type:"monotone",dataKey:"fail_rate",stroke:"'#dc2626'",dot:!1})]})})]}),s.jsxs("div",{className:`border rounded-lg p-4 shadow md:col-span-2 ${ce}`,children:[s.jsx("h3",{className:"font-semibold mb-2 text-green-600",children:"Top Tasks (volume & failure %)"}),s.jsx(a,{width:"100%",height:300,children:s.jsxs(t,{data:q.by_task,children:[s.jsx(l,{strokeDasharray:"3 3"}),s.jsx(r,{dataKey:"key"}),s.jsx(n,{}),s.jsx(o,{}),s.jsx(i,{}),s.jsx(d,{dataKey:"total",fill:"'#00a544'"}),s.jsx(d,{dataKey:"fail_rate",fill:"#f97316"})]})})]}),s.jsxs("div",{className:`border rounded-lg p-4 shadow md:col-span-2 ${ce}`,children:[s.jsx("h3",{className:"font-semibold mb-2 text-green-600",children:"Top Autopilots (volume & failure %)"}),s.jsx(a,{width:"100%",height:300,children:s.jsxs(t,{data:q.by_autopilot,children:[s.jsx(l,{strokeDasharray:"3 3"}),s.jsx(r,{dataKey:"key"}),s.jsx(n,{}),s.jsx(o,{}),s.jsx(i,{}),s.jsx(d,{dataKey:"total",fill:"'#4a3728'"}),s.jsx(d,{dataKey:"fail_rate",fill:"'#dc2626'"})]})})]})]})]}),s.jsx("div",{className:"p-4 rounded-lg font-mono text-sm whitespace-pre-wrap max-h-96 overflow-auto "+(y?"bg-black text-green-400":"bg-beige-100 text-brown-900"),children:S||"Ready."})]})})}export{m as default};
