import{r as e,j as s}from"./vendor-react-mXmGo1rS.js";import{supabase as t}from"./supabaseClient-mnOK5lWJ.js";import{A as r}from"./AppLayout-C3pbRaS2.js";import"./vendor-BU8AdXDg.js";import"./vendor-supabase-BOQaJsF3.js";import"./vendor-router-umqT_8ks.js";function d(){const[d,a]=e.useState(!0),[l,n]=e.useState([]),[i,c]=e.useState([]),[o,x]=e.useState(null);e.useEffect(()=>{m()},[]);const m=async()=>{if(!t)return x("Database service is not available"),void a(!1);try{a(!0),x(null);const{data:{user:e}}=await t.auth.getUser();if(!e)return void x("Please log in to view your grades");const{data:s,error:r}=await t.from("enrollments").select("\n          *,\n          courses (\n            id,\n            title,\n            code,\n            program_id\n          )\n        ").eq("user_id",e.id);if(r)throw r;c(s||[]);const{data:d,error:l}=await t.from("quiz_responses").select("\n          *,\n          quiz_questions (\n            id,\n            answer,\n            lesson_id,\n            lessons (\n              course_id,\n              title\n            )\n          )\n        ").eq("user_id",e.id);if(l)throw l;const i={};null==d||d.forEach(e=>{var s,t,r;const d=null==(t=null==(s=e.quiz_questions)?void 0:s.lessons)?void 0:t.course_id;if(!d)return;i[d]||(i[d]={correct:0,total:0,quizzes:[]});const a=e.answer===(null==(r=e.quiz_questions)?void 0:r.answer);i[d].total++,a&&i[d].correct++});const o=Object.entries(i).map(([e,s])=>({courseId:e,percentage:s.total>0?Math.round(s.correct/s.total*100):0,correct:s.correct,total:s.total}));n(o)}catch(e){console.error("Error fetching student grades:",e),x(e.message)}finally{a(!1)}};return s.jsx(r,{children:s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"My Grades"}),o&&s.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:s.jsx("p",{className:"text-red-800",children:o})}),d?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-brand-text-muted",children:"Loading grades..."})]}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-lg p-6 text-white",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Academic Summary"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[s.jsx("div",{className:"text-3xl font-bold",children:i.length}),s.jsx("div",{className:"text-sm",children:"Enrolled Courses"})]}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[s.jsx("div",{className:"text-3xl font-bold",children:l.reduce((e,s)=>e+s.total,0)}),s.jsx("div",{className:"text-sm",children:"Quizzes Completed"})]}),s.jsxs("div",{className:"bg-white/10 rounded-lg p-4",children:[s.jsxs("div",{className:"text-3xl font-bold",children:[l.length>0?Math.round(l.reduce((e,s)=>e+s.percentage,0)/l.length):0,"%"]}),s.jsx("div",{className:"text-sm",children:"Average Grade"})]})]})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow",children:[s.jsx("div",{className:"p-6 border-b",children:s.jsx("h2",{className:"text-2xl font-bold",children:"Course Grades"})}),0===i.length?s.jsxs("div",{className:"p-6 text-center text-brand-text-light",children:[s.jsx("p",{children:"You are not enrolled in any courses yet."}),s.jsx("a",{href:"/programs",className:"text-brand-info hover:underline mt-2 inline-block",children:"Browse Programs"})]}):s.jsx("div",{className:"divide-y",children:i.map(e=>{var t,r;const d=l.find(s=>{var t;return s.courseId===(null==(t=e.courses)?void 0:t.id)}),a=(null==d?void 0:d.percentage)||0,n=(e=>e>=90?"A":e>=80?"B":e>=70?"C":e>=60?"D":"F")(a),i=(e=>e>=90?"text-brand-success":e>=80?"text-brand-info":e>=70?"text-yellow-600":e>=60?"text-orange-600":"text-red-600")(a);return s.jsx("div",{className:"p-6 hover:bg-brand-surface transition",children:s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold text-brand-text",children:(null==(t=e.courses)?void 0:t.title)||"Unknown Course"}),s.jsx("p",{className:"text-sm text-brand-text-light",children:null==(r=e.courses)?void 0:r.code}),d&&s.jsxs("p",{className:"text-sm text-brand-text-muted mt-2",children:[d.correct," / ",d.total," ","quizzes correct"]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:`text-4xl font-bold ${i}`,children:n}),s.jsxs("div",{className:"text-lg text-brand-text-muted",children:[a,"%"]}),d?s.jsx("div",{className:"mt-2",children:a>=70?s.jsx("span",{className:"px-3 py-1 bg-brand-surface text-brand-success rounded-full text-xs font-semibold",children:"Passing"}):s.jsx("span",{className:"px-3 py-1 bg-brand-surface text-red-800 rounded-full text-xs font-semibold",children:"Needs Improvement"})}):s.jsx("div",{className:"mt-2",children:s.jsx("span",{className:"px-3 py-1 bg-brand-surface-dark text-brand-text-muted rounded-full text-xs font-semibold",children:"No Grades Yet"})})]})]})},e.course_id)})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[s.jsx("h3",{className:"text-lg font-bold mb-4",children:"Grading Scale"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-brand-success",children:"A"}),s.jsx("div",{className:"text-sm text-brand-text-muted",children:"90-100%"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-brand-info",children:"B"}),s.jsx("div",{className:"text-sm text-brand-text-muted",children:"80-89%"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:"C"}),s.jsx("div",{className:"text-sm text-brand-text-muted",children:"70-79%"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-orange-600",children:"D"}),s.jsx("div",{className:"text-sm text-brand-text-muted",children:"60-69%"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-red-600",children:"F"}),s.jsx("div",{className:"text-sm text-brand-text-muted",children:"0-59%"})]})]})]})]})]})})}export{d as default};
