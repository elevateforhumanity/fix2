import{r as e,j as r}from"./vendor-react-C-ZQNdj3.js";import{L as t}from"./vendor-router-CQjfSXV_.js";import{supabase as s}from"./supabaseClient-DCQoDyvc.js";import{A as a}from"./AppLayout-DjgAzEIN.js";import"./vendor-Da1LjC7-.js";import"./vendor-supabase-C00Cu5KO.js";function n(){const[n,i]=e.useState(!0),[o,l]=e.useState([]),[d,c]=e.useState("all"),[x,m]=e.useState(null);e.useEffect(()=>{b()},[]);const b=async()=>{if(!s)return m("Database service is not available"),void i(!1);try{i(!0),m(null);const{data:{user:e}}=await s.auth.getUser();if(!e)return void m("Please log in to view notifications");const{data:r,error:t}=await s.from("notifications").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});if(t)throw t;l(r||[])}catch(e){console.error("Error fetching notifications:",e),m(e.message)}finally{i(!1)}},u=async e=>{if(s)try{const{error:r}=await s.from("notifications").update({read:!0}).eq("id",e);if(r)throw r;l(o.map(r=>r.id===e?{...r,read:!0}:r))}catch(r){console.error("Error marking notification as read:",r)}},h=o.filter(e=>"unread"===d?!e.read:"read"!==d||e.read),f=o.filter(e=>!e.read).length,g=e=>{switch(e){case"success":return"✓";case"warning":return"⚠️";case"error":return"✗";default:return"ℹ️"}},p=e=>{switch(e){case"success":return"bg-green-50 border-green-200";case"warning":return"bg-yellow-50 border-yellow-200";case"error":return"bg-red-50 border-red-200";default:return"bg-blue-50 border-blue-200"}};return r.jsx(a,{children:r.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[r.jsxs("div",{className:"flex justify-between items-center mb-6",children:[r.jsx("h1",{className:"text-3xl font-bold",children:"Notification Center"}),f>0&&r.jsx("button",{onClick:async()=>{if(s)try{const{data:{user:e}}=await s.auth.getUser();if(!e)return;const{error:r}=await s.from("notifications").update({read:!0}).eq("user_id",e.id).eq("read",!1);if(r)throw r;l(o.map(e=>({...e,read:!0})))}catch(e){console.error("Error marking all as read:",e)}},className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition text-sm",children:"Mark All as Read"})]}),x&&r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:r.jsx("p",{className:"text-red-800",children:x})}),r.jsx("div",{className:"bg-white rounded-lg shadow mb-6",children:r.jsxs("div",{className:"flex border-b",children:[r.jsxs("button",{onClick:()=>c("all"),className:"flex-1 px-6 py-3 font-medium transition "+("all"===d?"border-b-2 border-blue-600 text-green-600":"text-brown-600 hover:text-brown-900"),children:["All (",o.length,")"]}),r.jsxs("button",{onClick:()=>c("unread"),className:"flex-1 px-6 py-3 font-medium transition "+("unread"===d?"border-b-2 border-blue-600 text-green-600":"text-brown-600 hover:text-brown-900"),children:["Unread (",f,")"]}),r.jsxs("button",{onClick:()=>c("read"),className:"flex-1 px-6 py-3 font-medium transition "+("read"===d?"border-b-2 border-blue-600 text-green-600":"text-brown-600 hover:text-brown-900"),children:["Read (",o.length-f,")"]})]})}),n?r.jsxs("div",{className:"text-center py-12",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-brown-600",children:"Loading notifications..."})]}):0===h.length?r.jsx("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:r.jsx("p",{className:"text-brown-500 text-lg",children:"No notifications to display"})}):r.jsx("div",{className:"space-y-3",children:h.map(e=>r.jsx("div",{className:`border-2 rounded-lg p-4 transition ${e.read?"bg-white border-brown-200":p(e.type)} ${e.read?"":"shadow-md"}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex items-start flex-1",children:[r.jsx("span",{className:"text-2xl mr-3",children:g(e.type)}),r.jsxs("div",{className:"flex-1",children:[r.jsxs("h3",{className:"font-bold text-lg mb-1",children:[e.title,!e.read&&r.jsx("span",{className:"ml-2 px-2 py-1 bg-green-600 text-white text-xs rounded-full",children:"New"})]}),r.jsx("p",{className:"text-brown-900 mb-2",children:e.message}),r.jsx("p",{className:"text-sm text-brown-500",children:new Date(e.created_at).toLocaleString()}),e.link&&r.jsx(t,{to:e.link,onClick:()=>u(e.id),className:"inline-block mt-2 text-green-600 hover:underline text-sm font-medium",children:"View Details →"})]})]}),r.jsxs("div",{className:"flex gap-2 ml-4",children:[!e.read&&r.jsx("button",{onClick:()=>u(e.id),className:"px-3 py-1 bg-beige-50 text-green-600 rounded hover:bg-blue-200 text-sm transition",children:"Mark Read"}),r.jsx("button",{onClick:()=>(async e=>{try{const{error:r}=await s.from("notifications").delete().eq("id",e);if(r)throw r;l(o.filter(r=>r.id!==e))}catch(r){console.error("Error deleting notification:",r)}})(e.id),className:"px-3 py-1 bg-beige-50 text-red-700 rounded hover:bg-red-200 text-sm transition",children:"Delete"})]})]})},e.id))})]})})}export{n as default};
