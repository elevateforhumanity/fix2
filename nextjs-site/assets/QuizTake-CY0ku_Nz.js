import{r as e,j as s}from"./vendor-react-mXmGo1rS.js";import{supabase as t}from"./supabaseClient-mnOK5lWJ.js";import{A as a}from"./AppLayout-C3pbRaS2.js";import{u as r,b as n}from"./vendor-router-umqT_8ks.js";import"./vendor-BU8AdXDg.js";import"./vendor-supabase-BOQaJsF3.js";function i(){var i;const{lessonId:l}=r(),d=n(),[o,c]=e.useState(!0),[u,b]=e.useState([]),[h,m]=e.useState({}),[x,g]=e.useState(!1),[p,f]=e.useState(null),[j,v]=e.useState(0);e.useEffect(()=>{N()},[l]);const N=async()=>{if(!t)return f("Database service is not available"),void c(!1);try{c(!0),f(null);const{data:{user:e}}=await t.auth.getUser();if(!e)return void f("Please log in to take the quiz");const{data:s,error:a}=await t.from("quiz_questions").select("*").eq("lesson_id",l).order("id");if(a)throw a;if(!s||0===s.length)return void f("No quiz questions found for this lesson");b(s)}catch(e){console.error("Error fetching quiz questions:",e),f(e.message)}finally{c(!1)}},w=u.length>0?Math.round((j+1)/u.length*100):0;return s.jsx(a,{children:s.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-3xl",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Take Quiz"}),o?s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),s.jsx("p",{className:"mt-4 text-brand-text-muted",children:"Loading quiz..."})]}):p?s.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[s.jsx("p",{className:"text-red-800",children:p}),s.jsx("button",{onClick:()=>window.history.back(),className:"mt-4 px-4 py-2 bg-brand-danger text-white rounded hover:bg-brand-danger-hover",children:"Go Back"})]}):u.length>0?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-lg shadow p-4",children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsxs("span",{className:"text-sm font-medium",children:["Question ",j+1," of ",u.length]}),s.jsxs("span",{className:"text-sm font-medium",children:[w,"%"]})]}),s.jsx("div",{className:"w-full bg-brand-border rounded-full h-2",children:s.jsx("div",{className:"bg-brand-info h-2 rounded-full transition-all duration-300",style:{width:`${w}%`}})})]}),s.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[s.jsx("h2",{className:"text-2xl font-bold mb-6",children:u[j].prompt}),s.jsx("div",{className:"space-y-3",children:null==(i=u[j].options)?void 0:i.map((e,t)=>s.jsxs("label",{className:"block p-4 border-2 rounded-lg cursor-pointer transition "+(h[u[j].id]===e?"border-blue-600 bg-blue-50":"border-brand-border-dark hover:border-blue-400"),children:[s.jsx("input",{type:"radio",name:`question-${u[j].id}`,value:e,checked:h[u[j].id]===e,onChange:()=>{return s=u[j].id,t=e,void m(e=>({...e,[s]:t}));var s,t},className:"mr-3"}),s.jsx("span",{className:"text-lg",children:e})]},t))})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("button",{onClick:()=>v(e=>Math.max(0,e-1)),disabled:0===j,className:"px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:"Previous"}),j<u.length-1?s.jsx("button",{onClick:()=>v(e=>Math.min(u.length-1,e+1)),className:"px-6 py-3 bg-brand-info text-white rounded-lg hover:bg-brand-info-hover transition",children:"Next"}):s.jsx("button",{onClick:async()=>{if(t)try{g(!0),f(null);const{data:{user:e}}=await t.auth.getUser();if(!e)return void f("Please log in to submit quiz");const s=u.map(s=>({question_id:s.id,user_id:e.id,answer:h[s.id]||null,created_at:(new Date).toISOString()})),{error:a}=await t.from("quiz_responses").upsert(s,{onConflict:"question_id,user_id"});if(a)throw a;d(`/quiz-results/${l}`)}catch(e){console.error("Error submitting quiz:",e),f(e.message)}finally{g(!1)}else f("Database service is not available")},disabled:x||Object.keys(h).length<u.length,className:"px-8 py-3 bg-brand-success text-white rounded-lg hover:bg-brand-success-hover disabled:opacity-50 disabled:cursor-not-allowed transition font-bold",children:x?"Submitting...":"Submit Quiz"})]}),s.jsxs("div",{className:"bg-brand-surface rounded-lg p-4",children:[s.jsxs("p",{className:"text-sm text-brand-text-muted",children:["Answered: ",Object.keys(h).length," / ",u.length]}),Object.keys(h).length<u.length&&s.jsx("p",{className:"text-sm text-orange-600 mt-1",children:"Please answer all questions before submitting"})]})]}):s.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:s.jsx("p",{className:"text-brand-text-muted",children:"No quiz available for this lesson"})})]})})}export{i as default};
