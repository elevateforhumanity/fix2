import{s as e}from"./supa-DdKhhKHf.js";async function t(t,r){const{data:s}=await e.from("lessons").select("id").eq("course_id",r);if(!s||0===s.length)return!1;const{data:a}=await e.from("lesson_progress").select("lesson_id, percent").eq("user_id",t).in("lesson_id",s.map(e=>e.id));return!(!a||a.length!==s.length)&&a.every(e=>100===e.percent)}async function r(r,s){const{data:a}=await e.from("certificates").select("*").eq("user_id",r).eq("course_id",s).single();if(a)return a;if(!(await t(r,s)))throw new Error("Course not completed");const i=`EFH-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,{data:o,error:n}=await e.from("certificates").insert([{user_id:r,course_id:s,certificate_number:i}]).select().single();if(n)throw n;return o}async function s(t){const{data:r,error:s}=await e.from("certificates").select("*, courses(title, code, total_hours, program_type, instructor_name), profiles(full_name, email)").eq("user_id",t).order("issued_at",{ascending:!1});if(s)throw s;return r}async function a(t){const{data:r,error:s}=await e.from("certificates").select("*, courses(title, code, total_hours, program_type, instructor_name), profiles(full_name, email)").eq("id",t).single();if(s)throw s;return r}async function i(t){const{data:r,error:s}=await e.from("certificates").select("*, courses(title, code, total_hours, program_type, instructor_name), profiles(full_name, email)").eq("certificate_number",t).single();return s?null:r}async function o(t){const{data:r,error:s}=await e.from("certificates").select("*, courses(title, code), profiles(email)").eq("certificate_number",t).single();return s?null:r}export{s as a,i as b,t as c,r as d,a as g,o as v};
