name: Block SPA Remnants
on: [push, pull_request]

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install ripgrep
        run: |
          sudo apt-get update
          sudo apt-get install -y ripgrep

      - name: Scan for banned SPA patterns
        run: |
          echo "üîç Scanning for SPA remnants..."

          # Check for banned patterns
          if rg -n "(create-react-app|react-scripts|vite\.config|craco|serviceWorker|registerServiceWorker|import\.meta\.env)" --type-add 'config:*.{js,ts,json,toml}' -t config -t js -t ts; then
            echo "‚ùå FAILED: SPA remnants detected!"
            echo "Please remove all React SPA code before merging."
            exit 1
          else
            echo "‚úÖ PASSED: No SPA remnants found"
          fi

          # Check for index.html at root
          if [ -f "index.html" ]; then
            echo "‚ùå FAILED: index.html found at root (SPA entry point)"
            exit 1
          fi

          # Check for vite configs
          if ls vite.config.* 2>/dev/null; then
            echo "‚ùå FAILED: Vite config files found"
            exit 1
          fi

          echo "‚úÖ All checks passed - repository is clean"
