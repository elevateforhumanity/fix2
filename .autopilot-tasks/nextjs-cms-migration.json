{
  "task_id": "nextjs-cms-migration-002",
  "task_name": "Deploy Next.js with CMS and Auth",
  "priority": "critical",
  "status": "active",
  "created_at": "2025-11-05T17:30:00Z",
  "type": "autonomous_deployment",
  "mode": "zero_manual",

  "download_token": "RcSFpHnIk12Uu_6NlbIZjzgT19Sltw2sChG33PiW",
  "package_name": "efh-next-ssg-ssr-auth-plus-cms.zip",

  "objectives": [
    "Download Next.js starter with CMS and auth",
    "Extract and configure environment",
    "Set up Supabase CMS bucket",
    "Create admin user with role",
    "Deploy to Netlify",
    "Configure custom domain",
    "Verify zero skeleton pages"
  ],

  "autonomous_steps": [
    {
      "step": 1,
      "name": "Download Package",
      "action": "download",
      "use_token": true,
      "token": "RcSFpHnIk12Uu_6NlbIZjzgT19Sltw2sChG33PiW",
      "destination": "/workspaces/fix2/efh-next-ssg-ssr-auth-plus-cms.zip",
      "verify_size": true,
      "auto_retry": true
    },
    {
      "step": 2,
      "name": "Extract and Setup",
      "action": "extract_configure",
      "source": "efh-next-ssg-ssr-auth-plus-cms.zip",
      "target": "/workspaces/fix2/nextjs-cms-site",
      "commands": [
        "cd /workspaces/fix2",
        "unzip -o efh-next-ssg-ssr-auth-plus-cms.zip -d nextjs-cms-site",
        "cd nextjs-cms-site",
        "npm install --legacy-peer-deps"
      ]
    },
    {
      "step": 3,
      "name": "Configure Environment",
      "action": "setup_env",
      "file": "/workspaces/fix2/nextjs-cms-site/.env.local",
      "variables": {
        "NEXT_PUBLIC_SUPABASE_URL": "https://cuxzzpsyufcewtmicszk.supabase.co",
        "NEXT_PUBLIC_SUPABASE_ANON_KEY": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1eHp6cHN5dWZjZXd0bWljc3prIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA3MzI0NzUsImV4cCI6MjA0NjMwODQ3NX0.9y3VZ_pqLbHqEqGJYqxQxqxQxqxQxqxQxqxQxqxQxqxQ",
        "NEXT_PUBLIC_API_URL": "https://api.elevateforhumanity.org"
      }
    },
    {
      "step": 4,
      "name": "Setup Supabase CMS Bucket",
      "action": "supabase_storage",
      "bucket_name": "cms",
      "public": true,
      "policies": [
        {
          "name": "Public read access",
          "definition": "bucket_id = 'cms'",
          "operation": "SELECT"
        },
        {
          "name": "Authenticated write access",
          "definition": "bucket_id = 'cms' AND auth.role() = 'authenticated'",
          "operation": "INSERT"
        }
      ]
    },
    {
      "step": 5,
      "name": "Create Admin User",
      "action": "supabase_auth",
      "email": "admin@elevateforhumanity.org",
      "password": "auto_generated",
      "user_metadata": {
        "role": "admin",
        "name": "Admin User",
        "created_by": "autopilot"
      }
    },
    {
      "step": 6,
      "name": "Build Next.js Site",
      "action": "build",
      "commands": ["cd /workspaces/fix2/nextjs-cms-site", "npm run build"],
      "verify_output": ".next",
      "fail_on_error": true
    },
    {
      "step": 7,
      "name": "Deploy to Netlify",
      "action": "netlify_deploy",
      "site_name": "elevateforhumanity-nextjs",
      "build_command": "npm run build",
      "publish_directory": ".next",
      "environment_variables": [
        "NEXT_PUBLIC_SUPABASE_URL",
        "NEXT_PUBLIC_SUPABASE_ANON_KEY",
        "NEXT_PUBLIC_API_URL"
      ],
      "auto_ssl": true
    },
    {
      "step": 8,
      "name": "Configure Custom Domain",
      "action": "domain_setup",
      "domain": "app.elevateforhumanity.org",
      "use_autopilot_script": true,
      "script": "scripts/autopilot-setup-portal-domain.sh",
      "dns_provider": "cloudflare",
      "auto_ssl": true
    },
    {
      "step": 9,
      "name": "Verify Deployment",
      "action": "verify",
      "checks": [
        {
          "type": "http",
          "url": "https://app.elevateforhumanity.org",
          "expect_status": 200,
          "expect_no_skeleton": true
        },
        {
          "type": "http",
          "url": "https://app.elevateforhumanity.org/app/login",
          "expect_status": 200
        },
        {
          "type": "http",
          "url": "https://app.elevateforhumanity.org/api/programs",
          "expect_status": 200,
          "expect_json": true
        }
      ]
    },
    {
      "step": 10,
      "name": "Commit and Document",
      "action": "git_commit",
      "message": "feat: Deploy Next.js with CMS and Supabase Auth\n\nAutonomous deployment by autopilot:\n- Next.js SSG/SSR site with no skeleton pages\n- Supabase Auth with role-based access\n- Admin/Worker dashboards\n- Content CMS with Storage\n- API proxy for backend\n- Custom domain configured\n\nCo-authored-by: Ona <no-reply@ona.com>",
      "push": true
    }
  ],

  "autonomous_config": {
    "zero_manual_intervention": true,
    "auto_retry_on_failure": true,
    "max_retries": 5,
    "self_healing": true,
    "rollback_on_critical_failure": true,
    "notify_on_completion": true,
    "continuous_monitoring": true
  },

  "success_criteria": [
    "Package downloaded and extracted",
    "Dependencies installed",
    "Environment configured",
    "Supabase CMS bucket created",
    "Admin user created",
    "Build successful",
    "Deployed to Netlify",
    "Custom domain configured",
    "HTTPS working",
    "No skeleton pages",
    "All API routes working",
    "Auth working",
    "Changes committed to git"
  ],

  "rollback_plan": {
    "enabled": true,
    "keep_old_deployment": true,
    "can_revert_dns": true,
    "backup_created": true
  },

  "estimated_time": "30-45 minutes",
  "risk_level": "low",
  "impact": "high"
}
