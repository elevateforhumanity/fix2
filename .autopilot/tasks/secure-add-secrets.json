{
  "task_id": "secure-add-secrets",
  "name": "Worker Task: Add Secrets to GitHub and Netlify",
  "description": "Direct workers to add Supabase keys through web interfaces",
  "version": "1.0.0",
  "priority": "critical",
  "security_level": "high",
  "worker_instructions": {
    "overview": "You will add environment variables to GitHub Secrets and Netlify through their web interfaces. Keys will be provided securely.",
    "estimated_time": "5 minutes",
    "required_access": [
      "GitHub account with admin access to elevateforhumanity/fix2",
      "Netlify account with access to site 12f120ab-3f63-419b-bc49-430f043415c1",
      "Supabase dashboard access to project cuxzzpsyufcewtmicszk"
    ]
  },
  "steps": [
    {
      "step": 1,
      "title": "Get Supabase Keys from Dashboard",
      "type": "worker_action",
      "platform": "supabase",
      "instructions": [
        "1. Open browser and go to: https://supabase.com/dashboard",
        "2. Sign in with your Supabase account",
        "3. Select project: cuxzzpsyufcewtmicszk",
        "4. Click 'Settings' (gear icon, bottom left)",
        "5. Click 'API' in settings menu",
        "6. You will see 3 values under 'Project API keys':",
        "   - Project URL",
        "   - anon public (starts with eyJhbGci...)",
        "   - service_role (starts with eyJhbGci...)",
        "7. Keep this tab open - you'll copy these values in next steps"
      ],
      "screenshot_required": false,
      "validation": {
        "type": "confirmation",
        "message": "Do you have the Supabase API settings page open with all 3 keys visible?"
      }
    },
    {
      "step": 2,
      "title": "Add Secret 1 to GitHub: NEXT_PUBLIC_SUPABASE_URL",
      "type": "worker_action",
      "platform": "github",
      "instructions": [
        "1. Open new tab: https://github.com/elevateforhumanity/fix2/settings/secrets/actions",
        "2. Click green 'New repository secret' button (top right)",
        "3. In 'Name' field, type exactly: NEXT_PUBLIC_SUPABASE_URL",
        "4. In 'Secret' field, copy the 'Project URL' from Supabase tab",
        "   (Should be: https://cuxzzpsyufcewtmicszk.supabase.co)",
        "5. Click green 'Add secret' button",
        "6. You should see success message and secret in the list"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you successfully add NEXT_PUBLIC_SUPABASE_URL to GitHub Secrets?"
      },
      "troubleshooting": [
        "If you don't see 'New repository secret' button, you may not have admin access",
        "Contact repository owner for access",
        "Make sure you're on the 'Actions' secrets page, not 'Dependabot' or 'Codespaces'"
      ]
    },
    {
      "step": 3,
      "title": "Add Secret 2 to GitHub: NEXT_PUBLIC_SUPABASE_ANON_KEY",
      "type": "worker_action",
      "platform": "github",
      "instructions": [
        "1. Still on GitHub Secrets page, click 'New repository secret' again",
        "2. Name: NEXT_PUBLIC_SUPABASE_ANON_KEY",
        "3. Secret: Copy the 'anon public' key from Supabase tab",
        "   (Long string starting with eyJhbGci...)",
        "4. Click 'Add secret'",
        "5. Verify it appears in the list"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you successfully add NEXT_PUBLIC_SUPABASE_ANON_KEY?"
      }
    },
    {
      "step": 4,
      "title": "Add Secret 3 to GitHub: SUPABASE_SERVICE_ROLE_KEY",
      "type": "worker_action",
      "platform": "github",
      "instructions": [
        "1. Click 'New repository secret' again",
        "2. Name: SUPABASE_SERVICE_ROLE_KEY",
        "3. Secret: Copy the 'service_role' key from Supabase tab",
        "   (Different long string starting with eyJhbGci...)",
        "4. ⚠️ IMPORTANT: This is a sensitive key with admin access",
        "5. Click 'Add secret'",
        "6. Verify all 3 secrets are now in the list"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you successfully add SUPABASE_SERVICE_ROLE_KEY?"
      },
      "security_warning": "The service_role key has full database access. Never share it or commit it to code."
    },
    {
      "step": 5,
      "title": "Add Variable 1 to Netlify: NEXT_PUBLIC_SUPABASE_URL",
      "type": "worker_action",
      "platform": "netlify",
      "instructions": [
        "1. Open new tab: https://app.netlify.com/",
        "2. Sign in to Netlify",
        "3. Find site with ID: 12f120ab-3f63-419b-bc49-430f043415c1",
        "   (Or search for 'elevateconnectsdirectory')",
        "4. Click on the site to open it",
        "5. Go to: Site settings → Environment variables",
        "6. Click 'Add a variable' button",
        "7. Key: NEXT_PUBLIC_SUPABASE_URL",
        "8. Value: Copy Project URL from Supabase tab",
        "9. Scopes: Select 'All scopes' or just 'Production'",
        "10. Click 'Create variable'"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you add NEXT_PUBLIC_SUPABASE_URL to Netlify?"
      }
    },
    {
      "step": 6,
      "title": "Add Variable 2 to Netlify: NEXT_PUBLIC_SUPABASE_ANON_KEY",
      "type": "worker_action",
      "platform": "netlify",
      "instructions": [
        "1. Still in Netlify Environment variables, click 'Add a variable'",
        "2. Key: NEXT_PUBLIC_SUPABASE_ANON_KEY",
        "3. Value: Copy 'anon public' key from Supabase tab",
        "4. Scopes: All scopes",
        "5. Click 'Create variable'"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you add NEXT_PUBLIC_SUPABASE_ANON_KEY to Netlify?"
      }
    },
    {
      "step": 7,
      "title": "Add Variable 3 to Netlify: SUPABASE_SERVICE_ROLE_KEY",
      "type": "worker_action",
      "platform": "netlify",
      "instructions": [
        "1. Click 'Add a variable'",
        "2. Key: SUPABASE_SERVICE_ROLE_KEY",
        "3. Value: Copy 'service_role' key from Supabase tab",
        "4. Scopes: All scopes",
        "5. Click 'Create variable'"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you add SUPABASE_SERVICE_ROLE_KEY to Netlify?"
      }
    },
    {
      "step": 8,
      "title": "Add Variable 4 to Netlify: NEXT_PUBLIC_APP_URL",
      "type": "worker_action",
      "platform": "netlify",
      "instructions": [
        "1. Click 'Add a variable'",
        "2. Key: NEXT_PUBLIC_APP_URL",
        "3. Value: https://elevateforhumanity.org",
        "4. Scopes: Production only",
        "5. Click 'Create variable'"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you add NEXT_PUBLIC_APP_URL?"
      }
    },
    {
      "step": 9,
      "title": "Add Variable 5 to Netlify: NEXT_PUBLIC_SITE_URL",
      "type": "worker_action",
      "platform": "netlify",
      "instructions": [
        "1. Click 'Add a variable'",
        "2. Key: NEXT_PUBLIC_SITE_URL",
        "3. Value: https://elevateforhumanity.org",
        "4. Scopes: Production only",
        "5. Click 'Create variable'"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you add NEXT_PUBLIC_SITE_URL?"
      }
    },
    {
      "step": 10,
      "title": "Add Variable 6 to Netlify: NODE_ENV",
      "type": "worker_action",
      "platform": "netlify",
      "instructions": [
        "1. Click 'Add a variable'",
        "2. Key: NODE_ENV",
        "3. Value: production",
        "4. Scopes: Production only",
        "5. Click 'Create variable'",
        "6. Verify you now have 6 variables total in Netlify"
      ],
      "validation": {
        "type": "checklist",
        "items": [
          "NEXT_PUBLIC_SUPABASE_URL",
          "NEXT_PUBLIC_SUPABASE_ANON_KEY",
          "SUPABASE_SERVICE_ROLE_KEY",
          "NEXT_PUBLIC_APP_URL",
          "NEXT_PUBLIC_SITE_URL",
          "NODE_ENV"
        ],
        "message": "Verify all 6 variables are listed in Netlify"
      }
    },
    {
      "step": 11,
      "title": "Trigger Netlify Deployment",
      "type": "worker_action",
      "platform": "netlify",
      "instructions": [
        "1. In Netlify, click 'Deploys' tab at the top",
        "2. Click 'Trigger deploy' button (top right)",
        "3. Select 'Clear cache and deploy site'",
        "4. Click to confirm",
        "5. You'll see a new deploy start with status 'Building'",
        "6. Wait and watch the build log"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did you trigger the deployment?"
      },
      "expected_duration": "2-3 minutes"
    },
    {
      "step": 12,
      "title": "Monitor Deployment Progress",
      "type": "worker_action",
      "platform": "netlify",
      "instructions": [
        "1. Stay on the Deploys page",
        "2. Click on the deploy that's building to see logs",
        "3. Watch for these success indicators:",
        "   ✓ 'Building Next.js...'",
        "   ✓ 'Compiled successfully'",
        "   ✓ 'Collecting page data' (should complete without errors)",
        "   ✓ 'Site is live'",
        "4. If you see 'Missing Supabase environment variables' error:",
        "   - Go back and verify all 6 variables are set correctly",
        "   - Check for typos in variable names (case-sensitive)",
        "   - Try deploying again",
        "5. When status shows 'Published', deployment is complete"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Did the deployment complete successfully with status 'Published'?"
      },
      "troubleshooting": [
        "If build fails with same error, double-check variable names are exact",
        "Verify no extra spaces in variable values",
        "Make sure you're adding to the correct Netlify site",
        "Try 'Clear cache and deploy' again"
      ]
    },
    {
      "step": 13,
      "title": "Verify Site is Live",
      "type": "worker_action",
      "platform": "browser",
      "instructions": [
        "1. Open new tab: https://elevateforhumanity.org",
        "2. Site should load without errors",
        "3. Check these URLs work:",
        "   - https://elevateforhumanity.org/sitemap.xml",
        "   - https://elevateforhumanity.org/robots.txt",
        "4. Try navigating to:",
        "   - /lms/courses",
        "   - /programs",
        "   - /login",
        "5. All pages should load correctly",
        "6. Open browser console (F12) and check for errors"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Is the site loading correctly without errors?"
      }
    },
    {
      "step": 14,
      "title": "Test Supabase Connection",
      "type": "worker_action",
      "platform": "browser",
      "instructions": [
        "1. Go to: https://elevateforhumanity.org/login",
        "2. Try to sign up or log in (if you have test credentials)",
        "3. If login/signup works, Supabase connection is successful",
        "4. Check browser console (F12) for any Supabase errors",
        "5. Network tab should show successful requests to Supabase"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Is Supabase connection working (no errors in console)?"
      },
      "optional": true
    },
    {
      "step": 15,
      "title": "Document Completion",
      "type": "worker_action",
      "platform": "documentation",
      "instructions": [
        "1. Take screenshot of successful deployment in Netlify",
        "2. Take screenshot of site loading at elevateforhumanity.org",
        "3. Note the deployment time and date",
        "4. Confirm all 3 GitHub Secrets are added",
        "5. Confirm all 6 Netlify variables are added",
        "6. Report completion to team"
      ],
      "validation": {
        "type": "confirmation",
        "message": "Have you documented the successful deployment?"
      }
    }
  ],
  "completion": {
    "message": "✅ All secrets added and site deployed successfully!",
    "worker_report": {
      "github_secrets_added": 3,
      "netlify_variables_added": 6,
      "deployment_status": "Published",
      "site_url": "https://elevateforhumanity.org",
      "verification": [
        "✓ Site loads without errors",
        "✓ Sitemap.xml accessible",
        "✓ Robots.txt accessible",
        "✓ Supabase connection working",
        "✓ No build errors"
      ]
    },
    "security_checklist": [
      "✓ Keys stored in GitHub Secrets (encrypted)",
      "✓ Keys stored in Netlify (encrypted)",
      "✓ No keys in git repository",
      "✓ Service role key kept secure"
    ]
  },
  "worker_support": {
    "help_channels": [
      "Check Netlify build logs for specific errors",
      "Verify all variable names are exact (case-sensitive)",
      "Ensure you have admin access to both GitHub and Netlify",
      "Contact team lead if you encounter access issues"
    ],
    "estimated_total_time": "5-10 minutes",
    "difficulty": "Easy - just following steps in web interfaces"
  }
}
