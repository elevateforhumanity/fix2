{
  "task_id": "vercel-redeploy-fix2-1c7w",
  "priority": "CRITICAL",
  "status": "pending",
  "created_at": "2025-11-15T10:45:00Z",
  "task_type": "vercel_deployment",
  "title": "Redeploy fix2-1c7w with latest clean code",
  "description": "Environment variables are already configured. Need to redeploy fix2-1c7w project with latest commit (7396ef0e) that has all deprecated packages removed. Currently deploying old commit (3d3bd68) with deprecation warnings.",
  "estimated_duration": "10-15 minutes",
  "cost_impact": "HIGH - Stopping failed builds will save money",
  "worker_requirements": {
    "access_needed": [
      "Vercel dashboard access (gitpod organization)",
      "Supabase dashboard access (project: cuxzzpsyufcewtmicszk)"
    ],
    "skills": [
      "Vercel configuration",
      "Environment variable setup",
      "Basic deployment verification"
    ]
  },
  "context": {
    "current_problem": {
      "wrong_project": "fix2-8mig",
      "old_commit": "3d3bd68",
      "issues": [
        "10+ deprecation warnings in build logs",
        "Failed builds costing money",
        "Deploying old code with deprecated packages"
      ]
    },
    "target_state": {
      "correct_project": "fix2-1c7w",
      "latest_commit": "7396ef0e",
      "expected_result": "Clean build with no warnings, site loads successfully"
    },
    "code_fixes_completed": [
      "Removed xss-clean, netlify-cli, quill, @sentry/nextjs",
      "Migrated from @supabase/auth-helpers to @supabase/ssr",
      "Fixed Stripe API version to 2025-10-29.clover",
      "Updated jest to remove inflight/glob warnings"
    ]
  },
  "steps": [
    {
      "step": 1,
      "action": "navigate_to_vercel",
      "instruction": "Open Vercel dashboard",
      "url": "https://vercel.com/gitpod/fix2-1c7w",
      "verification": "Confirm you can see the fix2-1c7w project dashboard"
    },
    {
      "step": 2,
      "action": "audit_all_environment_variables",
      "instruction": "Check ALL environments (Production, Preview, Development) and ensure all 6 variables are present in each",
      "details": {
        "location": "Settings → Environment Variables",
        "environments_to_check": ["Production", "Preview", "Development"],
        "required_variables": [
          {
            "key": "SUPABASE_URL",
            "value": "https://cuxzzpsyufcewtmicszk.supabase.co",
            "required_in": ["Production", "Preview", "Development"]
          },
          {
            "key": "SUPABASE_ANON_KEY",
            "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1eHp6cHN5dWZjZXd0bWljc3prIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA3MzI0NzUsImV4cCI6MjA0NjMwODQ3NX0.9y3VZ_pqLbHqEqGJYqxQxqxQxqxQxqxQxqxQxqxQxqxQ",
            "required_in": ["Production", "Preview", "Development"]
          },
          {
            "key": "SUPABASE_SERVICE_ROLE_KEY",
            "value": "GET_FROM_SUPABASE_DASHBOARD",
            "required_in": ["Production", "Preview", "Development"],
            "retrieval_url": "https://supabase.com/dashboard/project/cuxzzpsyufcewtmicszk/settings/api",
            "retrieval_note": "Find 'service_role' key (secret), click 'Reveal' and copy"
          },
          {
            "key": "NEXT_PUBLIC_SUPABASE_URL",
            "value": "https://cuxzzpsyufcewtmicszk.supabase.co",
            "required_in": ["Production", "Preview", "Development"]
          },
          {
            "key": "NEXT_PUBLIC_SUPABASE_ANON_KEY",
            "value": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1eHp6cHN5dWZjZXd0bWljc3prIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzA3MzI0NzUsImV4cCI6MjA0NjMwODQ3NX0.9y3VZ_pqLbHqEqGJYqxQxqxQxqxQxqxQxqxQxqxQxqxQ",
            "required_in": ["Production", "Preview", "Development"]
          },
          {
            "key": "NEXT_PUBLIC_SITE_URL",
            "value_production": "https://www.elevateconnectsdirectory.org",
            "value_preview": "https://fix2-1c7w-git-BRANCH.vercel.app",
            "value_development": "http://localhost:3000",
            "required_in": ["Production", "Preview", "Development"],
            "note": "Different values per environment"
          }
        ],
        "action_if_missing": "Add the missing variable with correct value for each environment",
        "action_if_wrong_value": "Update the variable to match the correct value",
        "action_if_wrong_environment": "Edit variable and check the missing environment boxes"
      },
      "verification_checklist": [
        "Production environment has all 6 variables",
        "Preview environment has all 6 variables",
        "Development environment has all 6 variables",
        "SUPABASE_SERVICE_ROLE_KEY is present (not placeholder)",
        "NEXT_PUBLIC_SITE_URL has correct value per environment",
        "All values match the specified values above"
      ]
    },
    {
      "step": 3,
      "action": "audit_and_cleanup_old_deployments",
      "instruction": "Review all Vercel projects, identify unused ones, and clean up old failed deployments",
      "details": {
        "projects_to_check": [
          {
            "name": "fix2-1c7w",
            "status": "KEEP - This is the correct project",
            "action": "Verify and use this one"
          },
          {
            "name": "fix2-8mig",
            "status": "DELETE - Wrong project, deploying old code",
            "action": "Delete this project if it exists"
          },
          {
            "name": "fix2-i3z8",
            "status": "DELETE - Old project from config",
            "action": "Delete this project if it exists"
          },
          {
            "name": "Any other fix2-* projects",
            "status": "REVIEW - Check if needed",
            "action": "Delete if not actively used"
          }
        ],
        "cleanup_steps": [
          {
            "step": "List all projects",
            "location": "Vercel Dashboard → Projects",
            "action": "Make a list of all projects starting with 'fix2'"
          },
          {
            "step": "Identify correct project",
            "action": "Confirm fix2-1c7w is the one connected to elevateforhumanity/fix2"
          },
          {
            "step": "Delete unused projects",
            "action": "For each unused project: Settings → Advanced → Delete Project"
          },
          {
            "step": "Clean up failed deployments",
            "location": "fix2-1c7w → Deployments",
            "action": "Review failed deployments, note any patterns, can delete old failed ones"
          }
        ],
        "old_deployments_review": {
          "location": "fix2-1c7w → Deployments tab",
          "check_for": [
            "Failed deployments with old commits (3d3bd68 and earlier)",
            "Deployments with deprecation warnings",
            "Deployments that never completed"
          ],
          "action": "Document which commits failed and why",
          "cleanup": "Can delete old failed deployments to clean up the list"
        }
      },
      "verification": "Only fix2-1c7w project remains, old failed deployments documented"
    },
    {
      "step": 4,
      "action": "trigger_deployment",
      "instruction": "Deploy the application",
      "details": {
        "location": "Deployments tab",
        "action": "Click 'Deploy' or 'Redeploy' button",
        "important": "UNCHECK 'Use existing build cache'",
        "expected_commit": "7396ef0e or newer"
      },
      "verification": "Deployment starts and shows correct commit hash"
    },
    {
      "step": 5,
      "action": "monitor_build",
      "instruction": "Watch build logs for success",
      "details": {
        "expected_duration": "2-3 minutes",
        "success_indicators": [
          "NO deprecation warnings (xss-clean, lodash.isequal, node-domexception, inflight)",
          "NO @supabase/auth-helpers warnings",
          "Build completes with '✓ Compiled successfully'",
          "No TypeScript errors"
        ],
        "failure_indicators": [
          "Module not found errors",
          "TypeScript compilation errors",
          "Environment variable errors"
        ]
      },
      "verification": "Build completes successfully with clean logs"
    },
    {
      "step": 6,
      "action": "verify_deployment",
      "instruction": "Test the deployed site",
      "details": {
        "test_urls": ["/", "/lms/dashboard", "/programs", "/login"],
        "expected_behavior": "All pages load without 500 errors (login redirect is OK)"
      },
      "verification": "All test pages load successfully"
    },
    {
      "step": 7,
      "action": "report_completion",
      "instruction": "Document the deployment",
      "details": {
        "create_file": "VERCEL_DEPLOYMENT_COMPLETE.md",
        "include": [
          "Deployment URL",
          "Commit hash deployed",
          "Build duration",
          "Any warnings or errors",
          "Verification results",
          "Timestamp"
        ]
      },
      "verification": "Completion report file created and committed"
    }
  ],
  "success_criteria": {
    "required": [
      "Repository connected to fix2-1c7w project",
      "All 6 environment variables configured in Production",
      "All 6 environment variables configured in Preview",
      "All 6 environment variables configured in Development",
      "SUPABASE_SERVICE_ROLE_KEY is set (not placeholder)",
      "NEXT_PUBLIC_SITE_URL has correct value per environment",
      "Build completes with no deprecation warnings",
      "Site loads without 500 errors",
      "Deployment URL accessible"
    ],
    "optional": [
      "Custom domain configured",
      "Old projects (fix2-8mig) disconnected"
    ]
  },
  "rollback_plan": {
    "if_build_fails": [
      "Check environment variables are correct",
      "Verify commit is 7396ef0e or newer",
      "Check build logs for specific error",
      "Consult WORKER_TASK_VERCEL_CONNECT.md troubleshooting section"
    ],
    "if_site_500_errors": [
      "Verify SUPABASE_SERVICE_ROLE_KEY is correct",
      "Check all 6 environment variables are set",
      "Check Vercel function logs for error details"
    ]
  },
  "documentation_references": [
    "WORKER_TASK_VERCEL_CONNECT.md",
    "AUTOPILOT_VERCEL_LINK.md",
    "VERCEL_DEPLOYMENT.md",
    "scripts/vercel-setup.sh"
  ],
  "estimated_cost_savings": "Significant - eliminates repeated failed builds",
  "blocking_issues": [],
  "dependencies": [],
  "assigned_to": null,
  "completed_at": null,
  "completion_notes": null
}
