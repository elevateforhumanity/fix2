{
  "task_id": "remove-elevateforhumanity-from-cloudflare",
  "title": "Remove elevateforhumanity.org from Cloudflare",
  "description": "Remove elevateforhumanity.org from Cloudflare to fix SSL handshake failure. Domain should be managed by Durablesites.co, not Cloudflare.",
  "priority": "critical",
  "status": "ready",
  "created_at": "2025-11-15T21:45:00Z",
  "worker_type": "cloudflare-api",
  "estimated_duration": "5 minutes",

  "prerequisites": {
    "cloudflare_access": true,
    "api_token_permissions": ["Zone:Read", "Zone:Edit"],
    "zone_name": "elevateforhumanity.org"
  },

  "problem": {
    "current_state": "elevateforhumanity.org is on Cloudflare nameservers",
    "issue": "SSL handshake failure - site is DOWN",
    "cause": "Domain incorrectly added to Cloudflare during Workers setup",
    "impact": "Marketing site completely inaccessible"
  },

  "solution": {
    "action": "Remove zone from Cloudflare",
    "method": "Cloudflare API",
    "result": "Domain returns to registrar/Durablesites management"
  },

  "steps": [
    {
      "step": 1,
      "action": "authenticate_cloudflare",
      "description": "Authenticate with Cloudflare API",
      "method": "GET",
      "endpoint": "https://api.cloudflare.com/client/v4/user/tokens/verify",
      "headers": {
        "Authorization": "Bearer ${CLOUDFLARE_API_TOKEN}",
        "Content-Type": "application/json"
      },
      "validation": "Response status 200 and result.status = 'active'"
    },
    {
      "step": 2,
      "action": "list_zones",
      "description": "Get zone ID for elevateforhumanity.org",
      "method": "GET",
      "endpoint": "https://api.cloudflare.com/client/v4/zones?name=elevateforhumanity.org",
      "headers": {
        "Authorization": "Bearer ${CLOUDFLARE_API_TOKEN}",
        "Content-Type": "application/json"
      },
      "extract": "result[0].id as ZONE_ID",
      "validation": "Zone found with name 'elevateforhumanity.org'"
    },
    {
      "step": 3,
      "action": "get_zone_details",
      "description": "Verify zone details before deletion",
      "method": "GET",
      "endpoint": "https://api.cloudflare.com/client/v4/zones/${ZONE_ID}",
      "headers": {
        "Authorization": "Bearer ${CLOUDFLARE_API_TOKEN}",
        "Content-Type": "application/json"
      },
      "validation": "Confirm zone name matches 'elevateforhumanity.org'"
    },
    {
      "step": 4,
      "action": "delete_zone",
      "description": "Remove zone from Cloudflare",
      "method": "DELETE",
      "endpoint": "https://api.cloudflare.com/client/v4/zones/${ZONE_ID}",
      "headers": {
        "Authorization": "Bearer ${CLOUDFLARE_API_TOKEN}",
        "Content-Type": "application/json"
      },
      "validation": "Response status 200 and success = true"
    },
    {
      "step": 5,
      "action": "verify_removal",
      "description": "Confirm zone no longer exists in Cloudflare",
      "method": "GET",
      "endpoint": "https://api.cloudflare.com/client/v4/zones?name=elevateforhumanity.org",
      "headers": {
        "Authorization": "Bearer ${CLOUDFLARE_API_TOKEN}",
        "Content-Type": "application/json"
      },
      "validation": "result array is empty"
    },
    {
      "step": 6,
      "action": "generate_report",
      "description": "Create removal report",
      "output_file": "/workspaces/fix2/CLOUDFLARE_REMOVAL_REPORT.md",
      "include": [
        "Zone ID removed",
        "Timestamp of removal",
        "Next steps for user",
        "DNS propagation timeline"
      ]
    }
  ],

  "api_examples": {
    "verify_token": {
      "curl": "curl -X GET 'https://api.cloudflare.com/client/v4/user/tokens/verify' -H 'Authorization: Bearer YOUR_TOKEN'"
    },
    "list_zones": {
      "curl": "curl -X GET 'https://api.cloudflare.com/client/v4/zones?name=elevateforhumanity.org' -H 'Authorization: Bearer YOUR_TOKEN'"
    },
    "delete_zone": {
      "curl": "curl -X DELETE 'https://api.cloudflare.com/client/v4/zones/ZONE_ID' -H 'Authorization: Bearer YOUR_TOKEN'"
    }
  },

  "execution_script": {
    "language": "bash",
    "script": "#!/bin/bash\n\nset -e\n\nCLOUDFLARE_API_TOKEN=\"${CLOUDFLARE_API_TOKEN}\"\n\nif [ -z \"$CLOUDFLARE_API_TOKEN\" ]; then\n  echo \"‚ùå Error: CLOUDFLARE_API_TOKEN not set\"\n  exit 1\nfi\n\necho \"üîê Verifying Cloudflare API token...\"\ncurl -s -X GET 'https://api.cloudflare.com/client/v4/user/tokens/verify' \\\n  -H \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  -H \"Content-Type: application/json\" | jq .\n\necho \"\"\necho \"üîç Finding zone ID for elevateforhumanity.org...\"\nZONE_RESPONSE=$(curl -s -X GET 'https://api.cloudflare.com/client/v4/zones?name=elevateforhumanity.org' \\\n  -H \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  -H \"Content-Type: application/json\")\n\nZONE_ID=$(echo $ZONE_RESPONSE | jq -r '.result[0].id')\n\nif [ \"$ZONE_ID\" = \"null\" ] || [ -z \"$ZONE_ID\" ]; then\n  echo \"‚úÖ Zone not found in Cloudflare (already removed or never added)\"\n  exit 0\nfi\n\necho \"üìã Zone ID: $ZONE_ID\"\n\necho \"\"\necho \"üóëÔ∏è  Removing zone from Cloudflare...\"\nDELETE_RESPONSE=$(curl -s -X DELETE \"https://api.cloudflare.com/client/v4/zones/$ZONE_ID\" \\\n  -H \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  -H \"Content-Type: application/json\")\n\necho $DELETE_RESPONSE | jq .\n\nSUCCESS=$(echo $DELETE_RESPONSE | jq -r '.success')\n\nif [ \"$SUCCESS\" = \"true\" ]; then\n  echo \"\"\n  echo \"‚úÖ Successfully removed elevateforhumanity.org from Cloudflare\"\n  echo \"\"\n  echo \"üìù Next steps:\"\n  echo \"  1. DNS will propagate within 1-48 hours\"\n  echo \"  2. Update nameservers at domain registrar to point to Durablesites\"\n  echo \"  3. Configure domain in Durablesites.co dashboard\"\n  echo \"  4. Wait for SSL certificate to provision\"\n  echo \"\"\nelse\n  echo \"‚ùå Failed to remove zone\"\n  echo $DELETE_RESPONSE | jq .\n  exit 1\nfi\n\necho \"\"\necho \"üîç Verifying removal...\"\nVERIFY_RESPONSE=$(curl -s -X GET 'https://api.cloudflare.com/client/v4/zones?name=elevateforhumanity.org' \\\n  -H \"Authorization: Bearer $CLOUDFLARE_API_TOKEN\" \\\n  -H \"Content-Type: application/json\")\n\nCOUNT=$(echo $VERIFY_RESPONSE | jq '.result | length')\n\nif [ \"$COUNT\" = \"0\" ]; then\n  echo \"‚úÖ Verified: Zone no longer exists in Cloudflare\"\nelse\n  echo \"‚ö†Ô∏è  Warning: Zone still appears in Cloudflare\"\nfi\n"
  },

  "github_secrets_required": {
    "CLOUDFLARE_API_TOKEN": {
      "description": "Cloudflare API token with Zone:Read and Zone:Edit permissions",
      "how_to_create": [
        "Go to https://dash.cloudflare.com/profile/api-tokens",
        "Click 'Create Token'",
        "Use 'Edit zone DNS' template or create custom",
        "Permissions: Zone:Read, Zone:Edit",
        "Zone Resources: Include - All zones",
        "Create token and copy it",
        "Add to GitHub Secrets: https://github.com/elevateforhumanity/fix2/settings/secrets/actions"
      ],
      "add_to_github": "gh secret set CLOUDFLARE_API_TOKEN --body 'YOUR_TOKEN_HERE'"
    }
  },

  "github_workflow": {
    "file": ".github/workflows/remove-cloudflare-zone.yml",
    "trigger": "workflow_dispatch",
    "description": "Manual workflow to remove elevateforhumanity.org from Cloudflare"
  },

  "success_criteria": {
    "zone_removed": true,
    "api_returns_empty": true,
    "report_generated": true,
    "user_notified": true
  },

  "post_removal_steps": {
    "immediate": [
      "Zone removed from Cloudflare",
      "DNS will start propagating",
      "Cloudflare no longer manages domain"
    ],
    "user_action_required": [
      "Login to domain registrar",
      "Change nameservers from Cloudflare to Durablesites or registrar default",
      "Login to Durablesites.co",
      "Configure custom domain: elevateforhumanity.org",
      "Wait for SSL certificate to provision (5-10 minutes)"
    ],
    "timeline": {
      "immediate": "Zone removed from Cloudflare",
      "1-2_hours": "DNS propagation begins",
      "24-48_hours": "Full DNS propagation worldwide",
      "after_nameserver_change": "Site will work once nameservers updated"
    }
  },

  "rollback_plan": {
    "description": "If removal was a mistake, zone can be re-added to Cloudflare",
    "steps": [
      "Go to Cloudflare dashboard",
      "Click 'Add a Site'",
      "Enter: elevateforhumanity.org",
      "Follow setup wizard",
      "Update nameservers at registrar"
    ],
    "note": "This is NOT recommended - domain should stay on Durablesites"
  },

  "documentation": {
    "issue_report": "ELEVATEFORHUMANITY_ORG_ISSUE.md",
    "fix_guide": "FIX_ELEVATEFORHUMANITY_DNS_NOW.md",
    "api_docs": "https://developers.cloudflare.com/api/operations/zones-delete-zone"
  },

  "notes": [
    "This fixes the SSL handshake failure",
    "Domain should be managed by Durablesites.co, not Cloudflare",
    "After removal, user must update nameservers at registrar",
    "elevateforhumanity.org should remain on Vercel (different domain)",
    "This is a one-time fix - do not re-add to Cloudflare"
  ]
}
