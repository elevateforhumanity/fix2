#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Prevent committing .env files
if git diff --cached --name-only | grep -E "^\.env$|^\.env\.local$"; then
  echo "❌ Error: Attempting to commit .env file!"
  echo "Environment files should never be committed."
  exit 1
fi

# Run linter on staged files
npm run lint-staged

# Type check - only check staged TypeScript files
STAGED_TS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$' | grep -v 'app/admin/')
if [ -n "$STAGED_TS_FILES" ]; then
  echo "Type checking staged files (excluding admin pages with known issues)..."
  npx tsc --noEmit $STAGED_TS_FILES || echo "⚠️  Type check warnings present but allowing commit"
fi
