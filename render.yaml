services:
  - type: web
    name: elevateforhumanity
    env: node
    buildCommand: pnpm install --frozen-lockfile=false && pnpm run build
    startCommand: node serve-static.cjs
    routes:
      # Serve sitemap and robots.txt as static files (SEO)
      - type: rewrite
        source: /sitemap.xml
        destination: /sitemap.xml
      - type: rewrite
        source: /robots.txt
        destination: /robots.txt
      - type: rewrite
        source: /sitemaps/*
        destination: /sitemaps/$1
      # Serve route-specific HTML files first (for SEO)
      - type: rewrite
        source: /programs
        destination: /programs/index.html
      - type: rewrite
        source: /get-started
        destination: /get-started/index.html
      - type: rewrite
        source: /hub
        destination: /hub/index.html
      - type: rewrite
        source: /connect
        destination: /connect/index.html
      - type: rewrite
        source: /lms
        destination: /lms/index.html
      - type: rewrite
        source: /student
        destination: /student/index.html
      - type: rewrite
        source: /meet
        destination: /meet/index.html
      - type: rewrite
        source: /drive
        destination: /drive/index.html
      - type: rewrite
        source: /calendar
        destination: /calendar/index.html
      # Fallback to root index.html for all other routes (SPA routing)
      - type: rewrite
        source: /*
        destination: /index.html
    headers:
      # Security Headers
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: X-XSS-Protection
        value: 1; mode=block
      - path: /*
        name: Referrer-Policy
        value: strict-origin-when-cross-origin
      - path: /*
        name: Strict-Transport-Security
        value: max-age=31536000; includeSubDomains; preload
      # CORS Headers - Allow Cloudflare Pages, Supabase, and local dev
      - path: /*
        name: Access-Control-Allow-Origin
        value: "*"
      - path: /*
        name: Access-Control-Allow-Methods
        value: GET, POST, PUT, DELETE, OPTIONS, PATCH
      - path: /*
        name: Access-Control-Allow-Headers
        value: Content-Type, Authorization, apikey, X-Client-Info, X-Supabase-Auth
      - path: /*
        name: Access-Control-Allow-Credentials
        value: "true"
      # Cache Headers
      - path: /assets/*
        name: Cache-Control
        value: public, max-age=31536000, immutable
      - path: /*.js
        name: Cache-Control
        value: public, max-age=31536000, immutable
      - path: /*.css
        name: Cache-Control
        value: public, max-age=31536000, immutable
    envVars:
      - key: NODE_ENV
        value: production
      - key: VITE_SUPABASE_URL
        value: https://cuxzzpsyufcewtmicszk.supabase.co
      - key: VITE_SUPABASE_ANON_KEY
        value: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN1eHp6cHN5dWZjZXd0bWljc3prIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgxNjEwNDcsImV4cCI6MjA3MzczNzA0N30.DyFtzoKha_tuhKiSIPoQlKonIpaoSYrlhzntCUvLUnA
      - key: VITE_API_URL
        value: https://elevateforhumanity.onrender.com
      - key: CLOUDFLARE_PAGES_URL
        value: https://elevateforhumanity.pages.dev
      # Add these secrets in Render dashboard if needed:
      # - SUPABASE_SERVICE_KEY (for admin operations)
      # - CLOUDFLARE_API_TOKEN (for backend operations)
