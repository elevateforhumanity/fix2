services:
  - type: web
    name: elevateforhumanity
    env: node
    buildCommand: pnpm install --frozen-lockfile=false && pnpm run build
    startCommand: node serve-static.js
    routes:
      # Serve route-specific HTML files first (for SEO)
      - type: rewrite
        source: /programs
        destination: /programs/index.html
      - type: rewrite
        source: /get-started
        destination: /get-started/index.html
      - type: rewrite
        source: /hub
        destination: /hub/index.html
      - type: rewrite
        source: /connect
        destination: /connect/index.html
      - type: rewrite
        source: /lms
        destination: /lms/index.html
      - type: rewrite
        source: /student
        destination: /student/index.html
      - type: rewrite
        source: /meet
        destination: /meet/index.html
      - type: rewrite
        source: /drive
        destination: /drive/index.html
      - type: rewrite
        source: /calendar
        destination: /calendar/index.html
      # Fallback to root index.html for all other routes (SPA routing)
      - type: rewrite
        source: /*
        destination: /index.html
    headers:
      # Security Headers
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
      - path: /*
        name: X-XSS-Protection
        value: 1; mode=block
      - path: /*
        name: Referrer-Policy
        value: strict-origin-when-cross-origin
      - path: /*
        name: Strict-Transport-Security
        value: max-age=31536000; includeSubDomains; preload
      # CORS Headers for Supabase
      - path: /*
        name: Access-Control-Allow-Origin
        value: https://cuxzzpsyufcewtmicszk.supabase.co
      - path: /*
        name: Access-Control-Allow-Methods
        value: GET, POST, PUT, DELETE, OPTIONS
      - path: /*
        name: Access-Control-Allow-Headers
        value: Content-Type, Authorization, apikey
      # Cache Headers
      - path: /assets/*
        name: Cache-Control
        value: public, max-age=31536000, immutable
      - path: /*.js
        name: Cache-Control
        value: public, max-age=31536000, immutable
      - path: /*.css
        name: Cache-Control
        value: public, max-age=31536000, immutable
    envVars:
      - key: NODE_ENV
        value: production
      - key: VITE_SUPABASE_URL
        value: https://cuxzzpsyufcewtmicszk.supabase.co
      # Add VITE_SUPABASE_ANON_KEY in Render dashboard (secret)
      # - key: VITE_SUPABASE_ANON_KEY
      #   sync: false  # Mark as secret in dashboard
