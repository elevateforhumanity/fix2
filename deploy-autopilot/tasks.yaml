# EFH LMS Deployment Tasks
# Run with: npm start (or npm run dry for preview)

tasks:
  # Step 1: Set up Supabase database
  - type: supabase.sql_file
    args:
      file: "../database/complete-lms-schema.sql"

  # Step 2: Deploy backend to Render
  - type: render.redeploy
    args:
      serviceId: "YOUR_RENDER_SERVICE_ID"  # Get from Render dashboard after creating service
      clearCache: true

  # Step 3: Deploy frontend to Cloudflare Pages
  - type: cloudflare.deploy_pages
    args:
      projectName: "elevate-for-humanity"
      branch: "main"

  # Step 4: Purge Cloudflare cache
  - type: cloudflare.purge

  # Optional: Set up custom domain DNS
  # - type: cloudflare.dns_upsert
  #   args:
  #     type: "CNAME"
  #     name: "www"
  #     content: "elevate-for-humanity.pages.dev"
  #     proxied: true

  # Optional: Create storage bucket for course files
  # - type: supabase.create_bucket
  #   args:
  #     name: "course-files"
  #     public: false
